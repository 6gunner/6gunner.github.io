(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{386:function(t,a,s){"use strict";s.r(a);var n=s(25),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"dva学习"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dva学习"}},[t._v("#")]),t._v(" Dva学习")]),t._v(" "),s("blockquote",[s("p",[t._v("官方文档 https://dvajs.com/guide/")]),t._v(" "),s("p",[t._v("已经升级为=> UMI")])]),t._v(" "),s("h2",{attrs:{id:"dva-是什么？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dva-是什么？"}},[t._v("#")]),t._v(" Dva 是什么？")]),t._v(" "),s("p",[t._v("dva是一个基于redux和redux-saga的数据流方案，再加上集成了react-router和fetch。可以理解为一套框架的总结。")]),t._v(" "),s("h2",{attrs:{id:"快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速入门"}},[t._v("#")]),t._v(" 快速入门")]),t._v(" "),s("h3",{attrs:{id:"最简结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#最简结构"}},[t._v("#")]),t._v(" 最简结构")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" dva "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dva'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./index.css'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. Initialize")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dva")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. Plugins")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.use({});")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. Model")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.model(require('./models/example').default);")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. Router")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("router")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./router'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5. Start")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#root'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"定义model"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定义model"}},[t._v("#")]),t._v(" 定义model")]),t._v(" "),s("p",[t._v("1.第一步是在main.js里通过app.model()方法来注册model")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("const app = dva();\n\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+ app.model({ /**/ });\n")]),t._v("\napp.router(() => <App />);\napp.start('#root');\n")])])]),s("p",[t._v("也可以在路由里指定组件使用的model，参考"),s("a",{attrs:{href:"#dva/dynamic"}},[t._v("dva/dynamic")])]),t._v(" "),s("p",[t._v("2.第二步是定义model")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    userInfo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keyang'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      age"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'28'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  subscriptions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xxx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("dispatch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" history"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  effects"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xxxx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("payload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" put"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  reducers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userInfo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[t._v("model里有很多属性，这里简单代过，后面有"),s("a",{attrs:{href:"#Model%E7%9A%84%E6%A6%82%E5%BF%B5"}},[t._v("详细介绍")])]),t._v(" "),s("ul",[s("li",[t._v("state：表示react里面维护的全局state。")]),t._v(" "),s("li",[s("a",{attrs:{href:"#subscription"}},[t._v("subscriptions")]),t._v(": 可以理解为dva提供的一种监听机制，它会在应用刚启动时执行所有的方法。你可以在里面去定义一些监听事件，包括初订阅ws请求、绑定各种键盘、路由变化的监听器等。")]),t._v(" "),s("li",[s("a",{attrs:{href:"#effect"}},[t._v("effects")]),t._v("：一般用来放一些异步请求、或者是一些延迟的处理逻辑。")]),t._v(" "),s("li",[s("a",{attrs:{href:"#reducer"}},[t._v("reducers")]),t._v(":纯函数，用来改变state的")])]),t._v(" "),s("h4",{attrs:{id:"在view组件里使用dispatch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在view组件里使用dispatch"}},[t._v("#")]),t._v(" 在view组件里使用dispatch")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IndexPage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dispatch "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("increment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 带上namespace")]),t._v("\n      type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example/incrementAsync'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("className")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("styles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("normal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("className")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("styles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("当前数量：")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("className")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("styles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("welcome"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onClick")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("increment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("增加\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onClick")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example/decrementAsync'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("减少\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n    ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"在view组件里使用connect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在view组件里使用connect"}},[t._v("#")]),t._v(" 在view组件里使用connect")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" connect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dva'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapStateToProps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" todos"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("todos "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mapStateToProps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IndexPage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"dva路由跳转"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dva路由跳转"}},[t._v("#")]),t._v(" dva路由跳转")]),t._v(" "),s("ul",[s("li",[t._v("通过LINK组件跳转")]),t._v(" "),s("li",[t._v("通过history对象跳转")]),t._v(" "),s("li",[t._v("用dva/withRouter提供的redux action进行跳转")])]),t._v(" "),s("h2",{attrs:{id:"代码规范-约束"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码规范-约束"}},[t._v("#")]),t._v(" 代码规范/约束")]),t._v(" "),s("h3",{attrs:{id:"组件定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件定义"}},[t._v("#")]),t._v(" 组件定义")]),t._v(" "),s("p",[t._v("在 dva 中我们通常将Container Components（容器组件）约束为 Rout.，因为在 dva 中我们通常以页面维度来设计 Container Components。")]),t._v(" "),s("p",[t._v("所以在 dva 中，通常需要 connect Model的组件都是 Route Components，组织在"),s("code",[t._v("/routes/")]),t._v("目录下，而"),s("code",[t._v("/components/")]),t._v("目录下则是纯组件（Presentational Components 展示组件）。")]),t._v(" "),s("h2",{attrs:{id:"dva图解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dva图解"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"./Dva-%E5%9B%BE%E8%A7%A3"}},[t._v("dva图解")])]),t._v(" "),s("p",[t._v("https://www.yuque.com/flying.ni/the-tower/tvzasn")]),t._v(" "),s("h3",{attrs:{id:"核心特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心特性"}},[t._v("#")]),t._v(" 核心特性")]),t._v(" "),s("p",[t._v("https://umijs.org/guide/#architecture")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("elm 概念")]),t._v("，通过 reducers, effects 和 subscriptions 组织 model")]),t._v(" "),s("li",[s("strong",[t._v("插件机制")]),t._v("，比如 "),s("a",{attrs:{href:"https://github.com/dvajs/dva/tree/master/packages/dva-loading",target:"_blank",rel:"noopener noreferrer"}},[t._v("dva-loading"),s("OutboundLink")],1),t._v(" 可以自动处理 loading 状态，不用一遍遍地写 showLoading 和 hideLoading")]),t._v(" "),s("li",[s("strong",[t._v("支持 HMR")]),t._v("，基于 "),s("a",{attrs:{href:"https://github.com/dvajs/babel-plugin-dva-hmr",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel-plugin-dva-hmr"),s("OutboundLink")],1),t._v(" 实现 components、routes 和 models 的 HMR")])]),t._v(" "),s("h3",{attrs:{id:"和react-框架对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#和react-框架对比"}},[t._v("#")]),t._v(" 和react 框架对比")]),t._v(" "),s("h4",{attrs:{id:"react提供的东西"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react提供的东西"}},[t._v("#")]),t._v(" React提供的东西")]),t._v(" "),s("p",[t._v("提供组件的编写，将组件编译成虚拟 dom")]),t._v(" "),s("h4",{attrs:{id:"react不能解决的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react不能解决的问题"}},[t._v("#")]),t._v(" React不能解决的问题")]),t._v(" "),s("ul",[s("li",[t._v("组件间的通信：react目前只支持父子组件的传参。")]),t._v(" "),s("li",[t._v("数据流：\n"),s("ul",[s("li",[t._v("数据如何和 view 的串联？ redux")]),t._v(" "),s("li",[t._v("路由如何和数据绑定？react-router")]),t._v(" "),s("li",[t._v("如何编写异步请求。redux-middleware")])])])]),t._v(" "),s("h4",{attrs:{id:"dva的组成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dva的组成"}},[t._v("#")]),t._v(" dva的组成")]),t._v(" "),s("p",[t._v("所以基于上面react不能解决的问题，dva提出了一个总结方案。")]),t._v(" "),s("p",[t._v("dva = React-Router + Redux + Redux-saga")]),t._v(" "),s("h4",{attrs:{id:"app架构对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#app架构对比"}},[t._v("#")]),t._v(" App架构对比")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th",[t._v("原始")]),t._v(" "),s("th",[t._v("dva")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("路由")]),t._v(" "),s("td",[t._v("引用 react-router 组件，通过中间件将应用路由和 react-redux 结合在一起；")]),t._v(" "),s("td",[t._v("通过 dva/router 来引入，底层用的还是 react-router")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td"),t._v(" "),s("td")])])]),t._v(" "),s("h3",{attrs:{id:"数据流向"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据流向"}},[t._v("#")]),t._v(" 数据流向")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-02-24-003446.png",alt:"img"}})]),t._v(" "),s("p",[t._v("component 通过connect 使用state")]),t._v(" "),s("p",[t._v("通过dispatch actions触发reducer")]),t._v(" "),s("p",[t._v("如果是异步操作，通过sagas来触发effect进行异步请求")]),t._v(" "),s("p",[t._v("最终修改state")]),t._v(" "),s("h3",{attrs:{id:"model的概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#model的概念"}},[t._v("#")]),t._v(" model的概念")]),t._v(" "),s("h4",{attrs:{id:"namespace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#namespace"}},[t._v("#")]),t._v(" namespace")]),t._v(" "),s("p",[t._v("针对model的一个命名空间，这样就不同的model里面其实reducer、effect就可以重复命名，不用担心冲突了。")]),t._v(" "),s("h4",{attrs:{id:"reducer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reducer"}},[t._v("#")]),t._v(" reducer")]),t._v(" "),s("p",[t._v("reducer本身是一个纯函数，它是可以改变state的唯一一个方法。所有的更新state操作都是需要通过action来触发reducer，最终实现的。")]),t._v(" "),s("h4",{attrs:{id:"effect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#effect"}},[t._v("#")]),t._v(" effect")]),t._v(" "),s("p",[t._v("effect的定义是副作用。因为同样的输入不一定会得到同样的输出，这违背了reducer纯函数的概念，称之为副作用。dva实际上是通过"),s("a",{attrs:{href:"#Redux-Saga"}},[t._v("redux-saga")]),t._v("来进行异步请求的，但是他和redux的写法有一些细微的差别。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("incrementAsync")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" put "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 踩坑：这里写yield delay(1000) 会导致effect无法调用。")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'INCREMENT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decrementAsync")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" put "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DECREMENT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("第二参数里面有很多对象，是dva替我们封装的：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("take"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("take")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用来监听一个事件")]),t._v("\ntakem"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ƒ")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nput"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用一个reducer")]),t._v("\nall"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("effects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("race")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("effects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncall"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napply"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncps"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nfork"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fork")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nspawn"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("spawn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\njoin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncancel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nselect"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("select")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("selector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nactionChannel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("actionChannel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pattern"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncancelled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancelled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nflush"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("flush")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("channel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ngetContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsetContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntakeEvery"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("takeEvery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("patternOrChannel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntakeLatest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("takeLatest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("patternOrChannel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nthrottle"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ƒ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("throttle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pattern"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"subscription"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#subscription"}},[t._v("#")]),t._v(" subscription")]),t._v(" "),s("p",[t._v("subscription是用来订阅一个数据源，根据条件dispatch需要的action。数据源可以是ws连接、当前时间、history路由变化、keyboard输入等。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keymaster'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'count'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  subscriptions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keyEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("dispatch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 触发增加的action")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'⌘+up, ctrl+up'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'add'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("注意：subscriptions里面的属性名其实可以任意命名，dva其实并不关心对象里面到底是"),s("code",[t._v("keyEvent")]),t._v("还是"),s("code",[t._v("setUp")]),t._v("。所以开发者可以尽情的去定义，只需要自己管理好业务逻辑，做好业务拆分，避免代码量过大难以理解。")]),t._v(" "),s("p",[t._v("结合subscription.js这个源码来看")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-02-26-011438.png",alt:"image-20200226091438078"}})]),t._v(" "),s("p",[t._v("因为subs里面所有的属性都必须是方法。实际上它就是遍历subs里面所有的key，然后去调用这些方法，传入了dispatch、history两个对象。")]),t._v(" "),s("h2",{attrs:{id:"常用的api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用的api"}},[t._v("#")]),t._v(" 常用的API")]),t._v(" "),s("p",[t._v("https://dvajs.com/api/#dva")]),t._v(" "),s("h3",{attrs:{id:"dva-dynamic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dva-dynamic"}},[t._v("#")]),t._v(" dva/dynamic")]),t._v(" "),s("blockquote",[s("p",[t._v("动态加载组件")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" PageComponet "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dynamic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("models")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./models/users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("components")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./routes/Page"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("app: dva 实例，加载 models 时需要")]),t._v(" "),s("li",[t._v("models: 返回 Promise 数组的函数，Promise 返回 dva model")]),t._v(" "),s("li",[t._v("component：返回 Promise 的函数，Promise 返回 React Component")])]),t._v(" "),s("h2",{attrs:{id:"复杂用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复杂用法"}},[t._v("#")]),t._v(" 复杂用法")]),t._v(" "),s("h2",{attrs:{id:"dva配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dva配置"}},[t._v("#")]),t._v(" dva配置")]),t._v(" "),s("p",[t._v("dva的服务是使用roadhog来启动的，默认隐藏了webpack的配置文件。如果需要配置，需要去读roadhog的文档。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/sorrycc/roadhog/blob/master/README_zh-cn.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("roadhog"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("通过"),s("code",[t._v("npm i -g roadhog")]),t._v(" 安装的版本一直都是roadhog@0.6.1, 很奇怪。")]),t._v(" "),s("p",[t._v("新版本的roadhog安装，可以安装项目级别的 "),s("code",[t._v("yarn add roadhog")]),t._v("。")]),t._v(" "),s("p",[t._v("其实个人还是很不喜欢这些封装过的打包工具，一方面增加学习成本，另一方面，配置不透明，文档不全，出现问题都不知道怎么修改。")]),t._v(" "),s("p",[t._v("还是==推荐通过webpakc自己去搭建，或者使用别人提供的cli来搭建好基础架子，进行个性化调整==。")]),t._v(" "),s("p",[t._v("关闭编译时ESLINT检查")]),t._v(" "),s("p",[t._v("eslint本地开发工具支持就好了，编译时检查太慢。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ESLINT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("none roadhog dev\n")])])]),s("h3",{attrs:{id:"hmr配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hmr配置"}},[t._v("#")]),t._v(" HMR配置")]),t._v(" "),s("p",[t._v("关于roadhog的配置有很多，这里介绍一个常用的hmr配置。")]),t._v(" "),s("p",[t._v("dva里默认修改代码都是刷新浏览器页面的，想要不刷新页面，可以通过dva-hmr这个插件进行配置.")]),t._v(" "),s("p",[t._v("先按照github教程：安装依赖")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("npm install babel-plugin-dva-hmr redbox-react@1.x --save-dev\n")])])]),s("p",[t._v("在.webpackrc文件里配置")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("{\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+ "env": {\n+   "development": {\n+     "extraBabelPlugins": [\n+      "dva-hmr"\n+    ]\n+  }\n+ }\n')]),t._v("}\n")])])]),s("p",[t._v("然后运行，然而并没有什么鸟用。")]),t._v(" "),s("p",[t._v("去这个插件的issues里查看了一番，")]),t._v(" "),s("p",[t._v("发现是因为index.js 里没写 module.hot，修改app.js代码：")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import dva from 'dva';\nimport createHistory from 'history/createHashHistory';\n\nimport './index.css';\n\n// 1. Initialize\nconst app = dva({\n\thistory: createHistory(),\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+\tonHmr: () => {\n+\t\tif (module.hot) {\n+\t\t\tmodule.hot.accept();\n+\t\t}\n+\t}\n")]),t._v("});\n\n// 2. Plugins\n// app.use({});\n\n// 3. Model\napp.model(require('./models/example').default);\n\n// 4. Router\napp.router(require('./router').default);\n\n// 5. Start\napp.start('#root');\n\n\n\n")])])]),s("p",[t._v("开启后，就实现了hmr了。")]),t._v(" "),s("p",[t._v("==这个就和vue里面的不一样。vue-loader他可以帮我们实现hmr，所以只需要在webpack里配置就可以，但是react里就不行了。==")]),t._v(" "),s("p",[t._v("然后还有一个方式是使用这个插件 "),s("a",{attrs:{href:"https://github.com/gaearon/react-hot-loader",target:"_blank",rel:"noopener noreferrer"}},[t._v("react-hot-loader"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("先安装react-hot-loader插件")]),t._v(" "),s("p",[t._v("然后在代码里使用这个插件")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import dva from 'dva';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+ import { hot } from 'react-hot-loader/root';\n")]),t._v("\nimport './index.css';\n\n// 1. Initialize\n"),s("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t._v("- const app = dva();\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+ const app = hot(dva({\n+\tonHmr: (module) => {\n+\t\tif (module.hot) {\n+\t\t\tmodule.accept();\n+\t\t}\n+\t}\n+}));\n")]),t._v("\n// 2. Plugins\n// app.use({});\n\n// 3. Model\napp.model(require('./models/example').default);\n\n// 4. Router\napp.router(require('./router').default);\n\n// 5. Start\napp.start('#root');\n\n")])])]),s("p",[t._v("配置.webpackrc的babelPlugins")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"extraBabelPlugins"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"react-hot-loader/babel"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("总结一下：虽然上面两种方式，最终结果是支持了hmr，但是state都会丢失！！！\n所以这也是不想用dva的原因。")]),t._v(" "),s("h2",{attrs:{id:"经验总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#经验总结"}},[t._v("#")]),t._v(" 经验总结")]),t._v(" "),s("p",[t._v("1.put的时候，需要加一个yield")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("*watchFetchProducts({}, {call, put}) {\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+\t\t\tconst ret = yield call(Api.fetch, apis.products, { method: 'get'});\n")]),t._v("\t\t\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+\t\t\tyield put({\n")]),t._v("\t\t\t\ttype: 'UPDATE_PRODUCTS',\n\t\t\t\tproducts: ret.data\n\t\t\t})\n\t\t}\n")])])]),s("p",[t._v("2.调用异步方法，尽量用call(Api.fetch,  ...args)方法，有利于单元测试。")]),t._v(" "),s("p",[t._v("3.effects里调用另一个 effects通过yield")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user/getusergroupinfo'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  payload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//直到监听到结束才继续")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("take")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user/getusergroupinfo/@@end'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("4.yield 获取 state")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" address_list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("select")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("address_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("5.mockjs的统一写法，实现去读取某一个文件夹里面的js文件")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("const fs = require('fs');\nconst path = require('path')\nconst mockPath = path.join(__dirname + '/mock');\n\nconst mock = {};\nfs.readdirSync(mockPath).forEach(file => {\n\tObject.assign(mock,require('./mock/'+file));\n})\nmodule.exports=mock;\n\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);