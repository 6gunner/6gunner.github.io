(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{366:function(e,s,t){"use strict";t.r(s);var a=t(25),o=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"docker-compose-多容器部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-多容器部署"}},[e._v("#")]),e._v(" Docker Compose 多容器部署")]),e._v(" "),t("p",[e._v("主要用来本地开发的工具")]),e._v(" "),t("p",[e._v("docker 批处理")]),e._v(" "),t("p",[e._v("yml文件")]),e._v(" "),t("p",[e._v("docker-compose.yml 默认文件名")]),e._v(" "),t("p",[e._v("三大概念")]),e._v(" "),t("p",[e._v("services")]),e._v(" "),t("p",[e._v("1个service代表1个container。可以是docker hub pull的image，也可以是本地build的")]),e._v(" "),t("p",[e._v("可以指定volumes和networks")]),e._v(" "),t("p",[e._v("Networks")]),e._v(" "),t("p",[e._v("Volumes")]),e._v(" "),t("h2",{attrs:{id:"安装docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-compose"}},[e._v("#")]),e._v(" 安装Docker Compose")]),e._v(" "),t("p",[e._v("Mac和Windows不需要单独安装")]),e._v(" "),t("p",[e._v("Linux安装教程：https://docs.docker.com/compose/install")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ docker-compose --version\ndocker-compose version "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.24")]),e._v(".1, build 4667896b\n")])])]),t("h2",{attrs:{id:"基本命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本命令"}},[e._v("#")]),e._v(" 基本命令")]),e._v(" "),t("blockquote",[t("p",[e._v("创建启动")])]),e._v(" "),t("p",[t("code",[e._v("docker-compose up")]),e._v(" 默认去找"),t("code",[e._v("docker-compose.yml")])]),e._v(" "),t("p",[e._v("指定yml文件："),t("code",[e._v("docker-compose up -f 文件路径")])]),e._v(" "),t("p",[t("code",[e._v("-d")]),e._v(": 守护进程")]),e._v(" "),t("blockquote",[t("p",[e._v("列出所有的container")])]),e._v(" "),t("p",[t("code",[e._v("docker-compose ps")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-03-24-105223.png",alt:"image-20200324185223400"}})]),e._v(" "),t("p",[e._v("这个和"),t("code",[e._v("docker ps")]),e._v("的命令效果一致")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-03-24-103653.png",alt:"image-20200324183653037"}})]),e._v(" "),t("blockquote",[t("p",[e._v("开始container")])]),e._v(" "),t("p",[t("code",[e._v("docker-compose start")])]),e._v(" "),t("blockquote",[t("p",[e._v("执行单个的")])]),e._v(" "),t("p",[t("code",[e._v("docker-compose exec xxx bash")])]),e._v(" "),t("blockquote",[t("p",[e._v("停止container")])]),e._v(" "),t("p",[t("code",[e._v("docker-compose stop")])]),e._v(" "),t("blockquote",[t("p",[e._v("停止并且删除container")])]),e._v(" "),t("p",[t("code",[e._v("docker-compose down --volumes")])]),e._v(" "),t("p",[e._v("带上"),t("code",[e._v("--volumes")]),e._v("，可以一起删除volume")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker-compose down\nStopping compose_web_1   ... done\nStopping compose_redis_1 ... done\nRemoving compose_web_1   ... done\nRemoving compose_redis_1 ... done\nRemoving network compose_default\n")])])]),t("h3",{attrs:{id:"compose实例1-flask-redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#compose实例1-flask-redis"}},[e._v("#")]),e._v(" Compose实例1 - flask-redis")]),e._v(" "),t("p",[e._v("docker-compose.yml")]),e._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'3'")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("web")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" .\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"5000:5000"')]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" ."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("/code\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("FLASK_ENV")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" development\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"redis:alpine"')]),e._v("\n")])])]),t("p",[e._v("运行")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker-compose up -d\n")])])]),t("h2",{attrs:{id:"scale"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scale"}},[e._v("#")]),e._v(" Scale")]),e._v(" "),t("p",[e._v("使用--scale可以实现水平扩展container，实现简单的负载均衡服务。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker-compose up -d --scale web=3 \n")])])]),t("p",[t("strong",[e._v("负载均衡的实现")])]),e._v(" "),t("p",[t("code",[e._v("haproxy")])]),e._v(" "),t("h2",{attrs:{id:"build"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[e._v("#")]),e._v(" build")]),e._v(" "),t("p",[t("code",[e._v("docker-compose build")])]),e._v(" "),t("p",[e._v("可以用来单独进行编译，")]),e._v(" "),t("p",[e._v("up命令是先编译，再执行。")]),e._v(" "),t("h2",{attrs:{id:"常见问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[e._v("#")]),e._v(" 常见问题")]),e._v(" "),t("p",[e._v("碰到下载pipe很慢")]),e._v(" "),t("p",[e._v("可以在dockerfile里配置一下镜像")]),e._v(" "),t("p",[t("code",[e._v("RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories")])]),e._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),t("p",[e._v("docker-compose可以通过一个yml文件，来配置多个image，以及对应的关系。")]),e._v(" "),t("p",[e._v("通过程序来实现一个环境的配置，简化手动配置。")])])}),[],!1,null,null,null);s.default=o.exports}}]);