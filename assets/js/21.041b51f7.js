(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{379:function(e,t,s){"use strict";s.r(t);var i=s(25),a=Object(i.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h3",{attrs:{id:"credentials"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#credentials"}},[e._v("#")]),e._v(" credentials")]),e._v(" "),s("p",[e._v("在http的请求里，有一个"),s("code",[e._v("withCredentials")]),e._v("属性。它可以设置true或者false。 表示：在跨域请求的情况下，是否允许发送cookies。（同源请求下设置无效）")]),e._v(" "),s("p",[e._v("当设置"),s("code",[e._v("withCredentials")]),e._v("为true时，浏览器会向跨域的服务器发送cookie等验证信息。")]),e._v(" "),s("p",[e._v("设置withCredentials有两种方式：")]),e._v(" "),s("p",[e._v("1.通过``XMLHttpRequest.withCredentials`来设置")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("let xml = new XMLHttpRequest()\nxhr.open('POST', 'http://example.com/', true)\nxhr.withCredentials = true\nxhr.send(null)\n")])])]),s("p",[e._v("2.新版的api里，可以通过"),s("code",[e._v("credentials")]),e._v("来直接设置。它的值有3个：")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("omit: 从不发送cookies。")])]),e._v(" "),s("li",[s("p",[e._v("same-origin: 只有当URL与响应脚本同源才发送 cookies、 HTTP Basic authentication 等验证信息。")]),e._v(" "),s("p",[e._v("这是当前浏览器默认值, 在旧版本浏览器，例如safari 11依旧是omit，safari 12已更改")])]),e._v(" "),s("li",[s("p",[e._v("include: 不论是不是跨域的请求,总是发送请求资源域在本地的 cookies、 HTTP Basic authentication 等验证信息。")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("var myRequest = new Request('flowers.jpg', {\n\tcredentials: 'include';\n});\n")])])]),s("p",[e._v("==注意：如果请求端设置了"),s("code",[e._v("credentials")]),e._v("为"),s("code",[e._v("include")]),e._v(", 服务端接受到这个请求时，也需要做对应的处理==。")]),e._v(" "),s("ul",[s("li",[e._v("需要在response header里设置"),s("code",[e._v("Access-Control-Allow-Origin:")]),e._v("值为request host。")]),e._v(" "),s("li",[e._v("设置"),s("code",[e._v("Access-Control-Allow-Credentials: true")])])]),e._v(" "),s("p",[e._v("否则，浏览器无法处理请求。")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-04-12-000629.png",alt:"image-20200412080628464"}})]),e._v(" "),s("p",[s("img",{attrs:{src:"https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-04-12-002217.png",alt:"image-20200412082217152"}})]),e._v(" "),s("p",[e._v("图1是本身服务端限制了跨域接口。")]),e._v(" "),s("p",[e._v("图2是服务端允许``Access-Control-Allow-Origin:*"),s("code",[e._v("，但是因为客户端设置了")]),e._v("credentials`，所以浏览器还是认为不合法。")])])}),[],!1,null,null,null);t.default=a.exports}}]);