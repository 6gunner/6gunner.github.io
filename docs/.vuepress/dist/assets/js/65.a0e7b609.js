(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{424:function(n,e,t){"use strict";t.r(e);var r=t(25),o=Object(r.a)({},(function(){var n=this.$createElement,e=this._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":this.$parent.slotKey}},[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('// ==UserScript==\n// @name         大麦抢票-确认\n// @namespace    https://www.jwang0614.top/scripts\n// @version      0.7.1\n// @description  辅助购买大麦网演唱会门票\n// @author       Gunner Ke\n// @match        https://buy.damai.cn/orderConfirm*\n// @grant        none\n// @require      http://code.jquery.com/jquery-1.11.1.min.js\n// ==/UserScript==\n\n\nvar test_url = "https://buy.damai.cn/orderConfirm?exParams=%7B%22damai%22%3A%221%22%2C%22channel%22%3A%22damai_app%22%2C%22umpChannel%22%3A%2210002%22%2C%22atomSplit%22%3A%221%22%2C%22serviceVersion%22%3A%221.8.5%22%7D&buyParam=600583263497_1_4192587404863&buyNow=true&spm=a2oeg.project.projectinfo.dbuy"\nvar timer = null;\nvar current_url = null;\n$(document).ready(function(){\n    window.current_url = window.location.href;\n    if($(".error-msg").length > 0) {\n        if ($("#linkPage").length > 0) {\n           \t\t\t$("#linkPage").click();\n        } else {\n        window.location.reload();\n    \t}\n    }else {\n        var buyer_number = parseInt($(".ticket-buyer-title em").text());\n        var buyer_list = $(".buyer-list-item input");\n        for(var i=0; i < buyer_number; i++) {\n            buyer_list[i].click();\n        }\n\n        $(".submit-wrapper button").click();\n        // setTimeout(check_alert, 1500);\n\n    }\n\n\n});\n\n\nfunction check_alert() {\n    var alerts = $(".next-dialog-alert");\n    if(alerts.length > 0) {\n        window.location.reload();\n    }\n}\n\n\n\n\n\n')])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('// ==UserScript==\n// @name         大麦抢票-选场次票价人数\n// @namespace    https://www.jwang0614.top/scripts\n// @version      0.7.2\n// @description  辅助购买大麦网演唱会门票\n// @author       Olivia Wang\n// @match        https://detail.damai.cn/*\n// @grant        none\n// @require      http://code.jquery.com/jquery-1.11.1.min.js\n// ==/UserScript==\n\nvar sellStartTime_timestamp = null;\nvar order_url = null;\nvar timer = null;\n\n$(document).ready(function(){\n    var data = sessionStorage.getItem(\'order_url\');\n    if (data) {\n        window.location.href = data;\n    } else {\n        var service_note_name_seat = $(\'.service-note .service-note-name:first\').text().trim();\n        // var service_note_name_express = $(\'.service-note div.service-note-name\')[1].textContent.trim();\n\n        if($("div.buybtn").text() === "选座购买" || service_note_name_seat === "可选座"){\n            alert("目前不支持选座");\n        }\n        // else if(service_note_name_express !== "快递票"){\n        //     alert("目前只支持快递票");\n        // }\n        else {\n            insert_ui();\n        }\n    }\n\n\n\n});\n\nfunction insert_ui() {\n    var $service = $(".content-right .service");\n\n    var $style = $(\'<style>\'+\n        \'#control_container{margin: 20px 0; background:#e9e9e9;padding:20px 0;}\'+\n        \'#control_container button{width:80%;margin:10px 10%;padding:10px 0;font-size:30px;border-style: solid;}\'+\n        \'#start_btn{color:green;}\'+\n        \'#end_btn{color:red;}\'+\n        \'#number_input_wrapper{display: flex;justify-content:center;font-size: 20px; margin-bottom:20px;}\'+\n        \'#notice{margin:10px 10px;padding:10px 10px;color:darkslategrey;border-style: solid; border-width: 1px; border-color:darkslategrey;}\'+\n        \'#countdown_wrapper {display:none; font-size: 16px; text-align:center; background:#ffeaf1;}\'+\n        \'#countdown_wrapper p{width:100%;}\'+\n        \'#countdown {font-size: 20px; color:#ff1268;}\'+\n        \'</style>\');\n\n    var $control_container = $("<div id=\'control_container\'></div>");\n\n\n    var $number_input = $(\'<div id="number_input_wrapper">请输入人数：<input id="number_input" type="number" value="1" min="1" max="6"></div>\');\n    var $start_btn = $(\'<button id="start_btn">开始抢票</button>\');\n    var $end_btn = $(\'<button id="end_btn">停止抢票</button>\');\n    var $notice = $(\'<div id="notice"><h3>使用步骤</h3><p>0.登录，填写购票人信息</p><p>1.选择场次</p><p>2.选择价格</p><p>3.填写人数</p><p>4.点击‘开始抢票’</p></div>\');\n\n    var $countdown = $(\'<div id="countdown_wrapper"><p id="selected_event">event1</p><p id="selected_price">price2</p><p id="selected_number">1人</p><br><p>倒计时:</p><p id="countdown">00:00:00</p></div>\');\n    $control_container.append($style);\n    $control_container.append($number_input);\n    $control_container.append($start_btn);\n    $control_container.append($end_btn);\n    $control_container.append($notice);\n    // $control_container.append($countdown);\n\n    $control_container.insertBefore($service);\n    $countdown.insertBefore($control_container);\n\n    $("#start_btn").click(function(){\n        var event = $(".perform__order__select.perform__order__select__performs .select_right_list .active span:last-of-type").text();\n        var price = $(".select_right_list_item.sku_item.active .skuname").text();\n        var people_num = $("#number_input").val();\n        var data_json = JSON.parse($("#dataDefault").text());\n        window.sellStartTime_timestamp = data_json["sellStartTime"];\n\n        // console.log("sellStartTime_timestamp: " + sellStartTime_timestamp);\n        // console.log("now: " + Date.now());\n\n        // console.log(data_json);\n\n        $("#selected_event").text(event);\n        $("#selected_price").text(price);\n        $("#selected_number").text(people_num + "人");\n\n        $("#countdown_wrapper").show();\n\n\n        var result = generate_confirm_url(event, price, people_num,data_json);\n\n        if(result) {\n            window.order_url = result;\n            sessionStorage.setItem(\'order_url\', result);\n\n            console.log("countdown and go to confirm page");\n            timedUpdate();\n\n\n        } else {\n            console.error("不知道为什么获取场次票价人数出错了呢。");\n            alert("不知道为什么获取场次票价人数出错了呢。");\n\n        }\n\n\n\n\n\n    });\n\n    $("#end_btn").click(function(){\n        clearTimeout(window.timer);\n        $("#countdown_wrapper").hide();\n        sessionStorage.clear();\n    });\n\n}\n\nfunction generate_confirm_url(event, price, people_num, data_json) {\n    var performBases = data_json["performBases"];\n    var itemId = "";\n\n    for(var i=0; i<performBases.length; i++) {\n        var performBase = performBases[i];\n        var performs = performBase["performs"];\n        for(var j=0; j<performs.length; j++) {\n            var perform = performs[j];\n            if(perform["performName"] === event) {\n                itemId = perform["itemId"];\n                var skuList = perform["skuList"];\n                for(var k=0; k<skuList.length; k++) {\n                    var skuList_item = skuList[k];\n                    if(skuList_item["skuName"] === price) {\n                        var skuId = skuList_item["skuId"];\n                        return "https://buy.damai.cn/orderConfirm?exParams=%7B%22damai%22%3A%221%22%2C%22channel%22%3A%22damai_app%22%2C%22umpChannel%22%3A%2210002%22%2C%22atomSplit%22%3A%221%22%2C%22serviceVersion%22%3A%221.8.5%22%7D&buyParam=" + itemId + "_" + people_num + "_" + skuId + "&buyNow=true&spm=a2oeg.project.projectinfo.dbuy"\n\n                    }\n                }\n\n            }\n        }\n\n    }\n    return null;\n\n}\n\nfunction timedUpdate() {\n    // 提前2秒开始\n    var current_time = Date.now();\n    var time_difference = Math.ceil((window.sellStartTime_timestamp - current_time)/1000);\n    if (time_difference < 2) {\n        window.location.href = window.order_url;\n    } else {\n        var time_difference_str = time_difference.toHHMMSS();\n        $("#countdown").text(time_difference_str);\n\n        window.timer = setTimeout(timedUpdate, 1000);\n\n    }\n\n}\n\n\n//https://stackoverflow.com/a/31112615\nNumber.prototype.toHHMMSS = function() {\n    var hours = Math.floor(this / 3600) < 10 ? ("00" + Math.floor(this / 3600)).slice(-2) : Math.floor(this / 3600);\n    var minutes = ("00" + Math.floor((this % 3600) / 60)).slice(-2);\n    var seconds = ("00" + (this % 3600) % 60).slice(-2);\n    return hours + ":" + minutes + ":" + seconds;\n};\n\n\n')])])])])}),[],!1,null,null,null);e.default=o.exports}}]);