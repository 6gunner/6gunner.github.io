<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Coda的博客</title>
    <meta name="generator" content="VuePress 1.5.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="闲着无聊？那就读书吧">
    <link rel="preload" href="/assets/css/0.styles.c3659042.css" as="style"><link rel="preload" href="/assets/js/app.3bcc0bcc.js" as="script"><link rel="preload" href="/assets/js/2.c5c14eb8.js" as="script"><link rel="preload" href="/assets/js/50.69fff158.js" as="script"><link rel="prefetch" href="/assets/js/10.53889524.js"><link rel="prefetch" href="/assets/js/11.bded85d3.js"><link rel="prefetch" href="/assets/js/12.bde1e69c.js"><link rel="prefetch" href="/assets/js/13.216bacd3.js"><link rel="prefetch" href="/assets/js/14.2a3abe69.js"><link rel="prefetch" href="/assets/js/15.3d9c6b68.js"><link rel="prefetch" href="/assets/js/16.18276b87.js"><link rel="prefetch" href="/assets/js/17.0f0df718.js"><link rel="prefetch" href="/assets/js/18.55d8b011.js"><link rel="prefetch" href="/assets/js/19.c0045a3e.js"><link rel="prefetch" href="/assets/js/20.d9d49e93.js"><link rel="prefetch" href="/assets/js/21.93d2a403.js"><link rel="prefetch" href="/assets/js/22.a2a0af85.js"><link rel="prefetch" href="/assets/js/23.d172675f.js"><link rel="prefetch" href="/assets/js/24.e1e1691d.js"><link rel="prefetch" href="/assets/js/25.e2b132b3.js"><link rel="prefetch" href="/assets/js/26.ced2a385.js"><link rel="prefetch" href="/assets/js/27.e4e7fdda.js"><link rel="prefetch" href="/assets/js/28.39009050.js"><link rel="prefetch" href="/assets/js/29.ca40ed0c.js"><link rel="prefetch" href="/assets/js/3.b842b953.js"><link rel="prefetch" href="/assets/js/30.a94da205.js"><link rel="prefetch" href="/assets/js/31.74f35770.js"><link rel="prefetch" href="/assets/js/32.05011607.js"><link rel="prefetch" href="/assets/js/33.f02fbb83.js"><link rel="prefetch" href="/assets/js/34.739ed5c6.js"><link rel="prefetch" href="/assets/js/35.1dc1d512.js"><link rel="prefetch" href="/assets/js/36.fc766dde.js"><link rel="prefetch" href="/assets/js/37.a2e0b62b.js"><link rel="prefetch" href="/assets/js/38.361aaee8.js"><link rel="prefetch" href="/assets/js/39.c7281005.js"><link rel="prefetch" href="/assets/js/4.c4955446.js"><link rel="prefetch" href="/assets/js/40.90c4a1d2.js"><link rel="prefetch" href="/assets/js/41.c8e4d5a9.js"><link rel="prefetch" href="/assets/js/42.f5c2bf1b.js"><link rel="prefetch" href="/assets/js/43.a5512bd6.js"><link rel="prefetch" href="/assets/js/44.bb54c1b5.js"><link rel="prefetch" href="/assets/js/45.009766aa.js"><link rel="prefetch" href="/assets/js/46.a2ea99d9.js"><link rel="prefetch" href="/assets/js/47.2a2b2056.js"><link rel="prefetch" href="/assets/js/48.69595edc.js"><link rel="prefetch" href="/assets/js/49.6ebebd68.js"><link rel="prefetch" href="/assets/js/5.790d3fc0.js"><link rel="prefetch" href="/assets/js/51.226ec71a.js"><link rel="prefetch" href="/assets/js/52.d8eac68c.js"><link rel="prefetch" href="/assets/js/53.19d0927d.js"><link rel="prefetch" href="/assets/js/54.ac06f4fe.js"><link rel="prefetch" href="/assets/js/55.6d82b994.js"><link rel="prefetch" href="/assets/js/56.ccf19bf4.js"><link rel="prefetch" href="/assets/js/57.594e7b17.js"><link rel="prefetch" href="/assets/js/58.c90127f4.js"><link rel="prefetch" href="/assets/js/59.5d591b9e.js"><link rel="prefetch" href="/assets/js/6.720e350f.js"><link rel="prefetch" href="/assets/js/60.c8e17510.js"><link rel="prefetch" href="/assets/js/61.b037e070.js"><link rel="prefetch" href="/assets/js/62.ed4aab00.js"><link rel="prefetch" href="/assets/js/63.5c708a2a.js"><link rel="prefetch" href="/assets/js/64.0ebd4f2f.js"><link rel="prefetch" href="/assets/js/65.22c3784d.js"><link rel="prefetch" href="/assets/js/66.d00a221f.js"><link rel="prefetch" href="/assets/js/67.9be23755.js"><link rel="prefetch" href="/assets/js/68.49dae0b9.js"><link rel="prefetch" href="/assets/js/69.a46cc89a.js"><link rel="prefetch" href="/assets/js/7.9f6e7a1c.js"><link rel="prefetch" href="/assets/js/70.4ebb514e.js"><link rel="prefetch" href="/assets/js/71.da1fad39.js"><link rel="prefetch" href="/assets/js/72.d98a09aa.js"><link rel="prefetch" href="/assets/js/73.5efdf4d6.js"><link rel="prefetch" href="/assets/js/74.1e949167.js"><link rel="prefetch" href="/assets/js/75.39449fd3.js"><link rel="prefetch" href="/assets/js/76.fe85b9d0.js"><link rel="prefetch" href="/assets/js/77.6ad893e5.js"><link rel="prefetch" href="/assets/js/78.c0ba6cbe.js"><link rel="prefetch" href="/assets/js/79.dc93fed9.js"><link rel="prefetch" href="/assets/js/8.c6c4c9d5.js"><link rel="prefetch" href="/assets/js/80.0ebd0a9a.js"><link rel="prefetch" href="/assets/js/81.20ea5db3.js"><link rel="prefetch" href="/assets/js/9.75d01cd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c3659042.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Coda的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/服务端/" class="nav-link">
  服务端
</a></div><div class="nav-item"><a href="/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/android/" class="nav-link">
  android
</a></div><div class="nav-item"><a href="/DevOps/" class="nav-link">
  devOps
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/服务端/" class="nav-link">
  服务端
</a></div><div class="nav-item"><a href="/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/android/" class="nav-link">
  android
</a></div><div class="nav-item"><a href="/DevOps/" class="nav-link">
  devOps
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#问题-1：找不到-sdk" class="sidebar-link">问题 1：找不到 sdk</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#问题-2：无法联网" class="sidebar-link">问题 2：无法联网</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#adb-环境配置" class="sidebar-link">adb 环境配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#adb-shell-连接上手机" class="sidebar-link">adb shell 连接上手机</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#adb-mac-环境变量" class="sidebar-link">adb mac 环境变量</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#adb-install" class="sidebar-link">adb install</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#adb-pull-push" class="sidebar-link">adb pull&amp;push</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#打包-apk-命令" class="sidebar-link">打包 APK 命令</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#安卓-gradle-配置文件" class="sidebar-link">安卓 Gradle 配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#根目录下的-build-gradle" class="sidebar-link">根目录下的 build.gradle</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#根目录下的-gradle-properties" class="sidebar-link">根目录下的 gradle.properties</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#app-目录下的-build-gradle" class="sidebar-link">app 目录下的 build.gradle</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#配置-flavors" class="sidebar-link">配置 Flavors</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#buildconfig-类" class="sidebar-link">BuildConfig 类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#使用-buildconfig-自定义常量" class="sidebar-link">使用 BuildConfig 自定义常量</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#可以配置-buildconfig-的地方" class="sidebar-link">可以配置 BuildConfig 的地方</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#结合-gradle-properties-使用" class="sidebar-link">结合 gradle.properties 使用</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#theme-主题" class="sidebar-link">Theme 主题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#导航栏样式" class="sidebar-link">导航栏样式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#如何隐藏-statusbar" class="sidebar-link">如何隐藏 StatusBar</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#如何在-noactionbar-时向-activity-里添加-toolbar" class="sidebar-link">如何在 NoActionBar 时向 Activity 里添加 Toolbar</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#如何在导航栏添加菜单" class="sidebar-link">如何在导航栏添加菜单</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#android-单位" class="sidebar-link">Android 单位</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#drawable-资源" class="sidebar-link">Drawable 资源</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#什么是-drawable？" class="sidebar-link">什么是 Drawable？</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#常用的-drawable-类型" class="sidebar-link">常用的 Drawable 类型</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#drawable-文件" class="sidebar-link">Drawable 文件</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#res、drawable-与-mipmap-的区别" class="sidebar-link">res、drawable 与 mipmap 的区别</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#" class="sidebar-link"></a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#全屏处理" class="sidebar-link">全屏处理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#shadow-阴影的处理" class="sidebar-link">Shadow 阴影的处理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#字体样式" class="sidebar-link">字体样式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#gravity" class="sidebar-link">Gravity</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#layout-gravity-失效" class="sidebar-link">Layout_gravity 失效</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#tablayout-怎么设置左对齐？" class="sidebar-link">TabLayout 怎么设置左对齐？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#安卓适配刘海屏" class="sidebar-link">安卓适配刘海屏</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#dialog" class="sidebar-link">Dialog</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#dialogfragment" class="sidebar-link">DialogFragment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#使用-dialogfragment-的两种方式" class="sidebar-link">使用 DialogFragment 的两种方式</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#dialogfragment-生命周期" class="sidebar-link">DialogFragment 生命周期</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#dialogfragment-样式修改：" class="sidebar-link">DialogFragment 样式修改：</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#activity-生命周期" class="sidebar-link">Activity 生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#全局生命周期" class="sidebar-link">全局生命周期</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#可视化生命周期" class="sidebar-link">可视化生命周期</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#可交互生命周期" class="sidebar-link">可交互生命周期</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#几种生命周期变化的过程" class="sidebar-link">几种生命周期变化的过程</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#几种在页面里初始化组件的方式以及区别" class="sidebar-link">几种在页面里初始化组件的方式以及区别</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#获取-layoutinflater" class="sidebar-link">获取 LayoutInflater</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#viewpager-的使用" class="sidebar-link">ViewPager 的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#pageadapter" class="sidebar-link">PageAdapter</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#fragment-结合-viewpager" class="sidebar-link">Fragment 结合 ViewPager</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#tablayout" class="sidebar-link">TabLayout</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#简单使用" class="sidebar-link">简单使用</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#结合-viewpager-使用" class="sidebar-link">结合 ViewPager 使用</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#fragment" class="sidebar-link">Fragment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#使用-fragment-的两种方式" class="sidebar-link">使用 Fragment 的两种方式</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#fragment-的事物管理" class="sidebar-link">Fragment 的事物管理</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#fragment-的生命周期" class="sidebar-link">Fragment 的生命周期</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#getsupportfragmentmanager、getchildfragmentmanager-的区别" class="sidebar-link">getSupportFragmentManager、getChildFragmentManager 的区别</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#fragment-和-activity-间传递消息" class="sidebar-link">Fragment 和 Activity 间传递消息</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#fragment-懒加载" class="sidebar-link">Fragment 懒加载</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#-2" class="sidebar-link"></a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#constraintlayout" class="sidebar-link">ConstraintLayout</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#splashscreen" class="sidebar-link">SplashScreen</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#_1-listview" class="sidebar-link">1.ListView</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#_2-gridview" class="sidebar-link">2.GridView</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#_3-recyclerview" class="sidebar-link">3.RecyclerView</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#_1-getstring-的使用" class="sidebar-link">1 getString 的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#-3" class="sidebar-link"></a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#_2-多线程使用" class="sidebar-link">2 多线程使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#方式-1：handler-thread" class="sidebar-link">方式 1：Handler + Thread</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#方式-2：asynctask" class="sidebar-link">方式 2：AsyncTask</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#方式-3：handlerthread" class="sidebar-link">方式 3：HandlerThread</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#方式-4：intentservice" class="sidebar-link">方式 4：IntentService</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#_3-系统语言获取" class="sidebar-link">3 系统语言获取</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#_4-组件传值" class="sidebar-link">4 组件传值</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#事件传递" class="sidebar-link">事件传递</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#bus" class="sidebar-link">Bus</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#eventbus" class="sidebar-link">EventBus</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#intent-传值" class="sidebar-link">Intent 传值</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#文件存储" class="sidebar-link">文件存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#内部存储" class="sidebar-link">内部存储</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%AE%89%E5%8D%93/Android.html#外部存储" class="sidebar-link">外部存储</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>https://github.com/JsonChao/Awesome-Android-Notebook</p></blockquote> <h1 id="一、搭建开发环境"><a href="#一、搭建开发环境" class="header-anchor">#</a> 一、搭建开发环境</h1> <h2 id="问题-1：找不到-sdk"><a href="#问题-1：找不到-sdk" class="header-anchor">#</a> 问题 1：找不到 sdk</h2> <p><strong>问题描述</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>adb server version <span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> doesn<span class="token string">'t match this client (35); killing...
error: could not install *smartsocket* listener: Address already in use
ADB server didn'</span>t ACK
* failed to start daemon *
error: cannot connect to daemon
</code></pre></div><p><strong>解决方法</strong></p> <p>命令行的 adb 是用 Android SDK 自带的，而 Genymotion 根本不知道 sdk 的位置。因此 Genymotion 的 adb 和 Android sdk 里的 adb 冲突了。只要修改 Genymotion 里的 adb 为 Android SDK 的，就可以识别了。</p> <p>具体去修改 Genymotion 的偏好设置即可</p> <h2 id="问题-2：无法联网"><a href="#问题-2：无法联网" class="header-anchor">#</a> 问题 2：无法联网</h2> <p><strong>问题描述</strong>：模拟器 app 无法连接网络</p> <p><strong>解决方法</strong></p> <p>在 virtual box 里面配置网络，截图如下：</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-12-19-074502.png" alt="201831585235836"></p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-12-19-074543.png" alt="201831585253185"></p> <h2 id="adb-环境配置"><a href="#adb-环境配置" class="header-anchor">#</a> adb 环境配置</h2> <h2 id="adb-shell-连接上手机"><a href="#adb-shell-连接上手机" class="header-anchor">#</a> adb shell 连接上手机</h2> <h3 id="adb-mac-环境变量"><a href="#adb-mac-环境变量" class="header-anchor">#</a> adb mac 环境变量</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Setting Path for ADB</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ANDROID_HOME</span><span class="token operator">=</span><span class="token string">&quot;/Users/keyang/Library/Android/sdk&quot;</span>
<span class="token builtin class-name">export</span> ANDROID_HOME
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">${<span class="token environment constant">PATH</span>}</span><span class="token builtin class-name">:</span><span class="token variable">${ANDROID_HOME}</span>/tools
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">${<span class="token environment constant">PATH</span>}</span><span class="token builtin class-name">:</span><span class="token variable">${ANDROID_HOME}</span>/platform-tools
</code></pre></div><h3 id="adb-install"><a href="#adb-install" class="header-anchor">#</a> adb install</h3> <p>adb -s {seria number} install xxx.apk 在指定设备上安装 apk</p> <h3 id="adb-pull-push"><a href="#adb-pull-push" class="header-anchor">#</a> adb pull&amp;push</h3> <p>作用： 修改模拟器 host 文件</p> <p>操作步骤：</p> <ol><li>获取 root 权限</li></ol> <p>./adb root</p> <p>【Q】如果出现错误：“adb cannot run as root in production builds”， 那是由于 root 不完全；</p> <p>【A】安装“超级 adb“；</p> <ol start="2"><li><p>修改 system 权限：./adb remount</p></li> <li><p>获取 host 文件到本地： ./adb pull /system/etc/hosts 修改 host 文件</p></li> <li><p>回写文件到虚拟机：./adb push hosts /system/etc/</p> <p>若出现文件只读不可回写，执行./adb reboot 重启，并再次获取权限，再回写文件。</p></li></ol> <h2 id="打包-apk-命令"><a href="#打包-apk-命令" class="header-anchor">#</a> 打包 APK 命令</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>./gradlew clean assemblequickbrokerReleaseChannels
</code></pre></div><h1 id="二、gradle"><a href="#二、gradle" class="header-anchor">#</a> 二、Gradle</h1> <h2 id="安卓-gradle-配置文件"><a href="#安卓-gradle-配置文件" class="header-anchor">#</a> 安卓 Gradle 配置文件</h2> <ol><li><h3 id="根目录下的-build-gradle"><a href="#根目录下的-build-gradle" class="header-anchor">#</a> 根目录下的 build.gradle</h3> <p>根目录下的 build.gradle 文件用于添加子工程或模块共用的配置项</p> <p>buildscript: 用来设置整个项目的 classpath</p> <p>allprojects: 项目的所有子工程都会用到这个配置，</p></li> <li><h3 id="根目录下的-gradle-properties"><a href="#根目录下的-gradle-properties" class="header-anchor">#</a> 根目录下的 gradle.properties</h3> <p>gradle.properties 里面定义的属性是全局的，可以在各个模块的 build.gradle 里面直接引用.</p></li> <li><h3 id="app-目录下的-build-gradle"><a href="#app-目录下的-build-gradle" class="header-anchor">#</a> app 目录下的 build.gradle</h3></li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token comment">// com.android.application 这是一个application</span>
<span class="token comment">// com.android.library 这是一个库</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">'com.android.application'</span>
<span class="token comment">// 配置项目的各种属性</span>
android <span class="token punctuation">{</span>
  compiledSdkVersion <span class="token number">28</span> <span class="token comment">//项目编译的sdk版本，也就是API level</span>
  <span class="token comment">// 程序默认配置，指定应用程序包名，最小sdk版本，目标sdk版本，版本号，版本名</span>
  defaultConfig <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
  <span class="token comment">// 指定生成安装文件的配置，常有两个子包:release,debug，</span>
  <span class="token comment">// 注：直接运行的都是debug安装文件</span>
  buildTypes <span class="token punctuation">{</span>
    debug <span class="token punctuation">{</span>
      applicationIdSuffix <span class="token string gstring">&quot;.debug&quot;</span>
    <span class="token punctuation">}</span>
    release <span class="token punctuation">{</span>
      proguardFiles <span class="token function">getDefaultProguardFile</span><span class="token punctuation">(</span><span class="token string">'proguard-android.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'proguard-rules.pro'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 文件配置</span>
  sourceSets <span class="token punctuation">{</span>
    main <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span>srcDirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'src/main/res'</span><span class="token punctuation">,</span> <span class="token string">'src/main/res-night'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    quickbroker <span class="token punctuation">{</span>
      java<span class="token punctuation">.</span>srcDirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'src/quickbroker/java'</span><span class="token punctuation">]</span>
      res<span class="token punctuation">.</span>srcDirs <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'src/quickbroker/res'</span><span class="token punctuation">]</span>
      manifest<span class="token punctuation">.</span>srcFile <span class="token string">'src/quickbroker/AndroidManifest.xml'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 声明有哪些flavor的维度</span>
  flavorDimensions <span class="token string gstring">&quot;broker&quot;</span>
  <span class="token comment">// productFlavors是可定义的产品特性</span>
  productFlavors <span class="token punctuation">{</span>
    dimension <span class="token string gstring">&quot;broker&quot;</span> <span class="token comment">// 每一个flavor都必须有一个dimension</span>
    <span class="token comment">//buildConfigField用于给BuildConfig文件添加一个字段</span>
    <span class="token comment">//三个参数:1.要定义的常量的类型 2.该常量的命名 3.该常量的值</span>
    <span class="token function">buildConfigField</span><span class="token punctuation">(</span><span class="token string gstring">&quot;String&quot;</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;DOMAIN&quot;</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;\&quot;<span class="token expression"><span class="token punctuation">$</span>DOMAIN</span>\&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="配置-flavors"><a href="#配置-flavors" class="header-anchor">#</a> 配置 Flavors</h2> <ul><li><p>productFlavors 与 buildTypes 是多对多的关系</p></li> <li><p>productFlavor 其实是 defaultConfig 的子集</p></li> <li><p>productFlavors 下可以新增多个 flavor，每个 flavor 都可以覆盖 defaultConfig 下的属性实现差异化。如：包名、应用名、编译版本；</p></li></ul> <h2 id="buildconfig-类"><a href="#buildconfig-类" class="header-anchor">#</a> BuildConfig 类</h2> <p>BuildConfig 类是 Android 打包以后自动生成的一个类,它位于 build/generated/source/buildConfig/**/debug 中或者 release 中</p> <p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g4sa1jqaojj30dj0cmwf7.jpg" alt="image-20190708113710871"></p> <ol><li><h3 id="使用-buildconfig-自定义常量"><a href="#使用-buildconfig-自定义常量" class="header-anchor">#</a> 使用 BuildConfig 自定义常量</h3></li> <li><h3 id="可以配置-buildconfig-的地方"><a href="#可以配置-buildconfig-的地方" class="header-anchor">#</a> 可以配置 BuildConfig 的地方</h3></li></ol> <div class="language- extra-class"><pre class="language-text"><code>// 在buildConfig里面使用
defaultConfig {
	buildConfigField(&quot;String&quot;,&quot;testKey&quot;,&quot;\&quot;testValue\&quot;&quot;)
}
// 在buildTypes里使用
buildTypes {
  debug {
    buildConfigField(&quot;String&quot;,&quot;testKey&quot;,&quot;\&quot;testValue\&quot;&quot;)
  },
  release {
    buildConfigField(&quot;String&quot;,&quot;testKey&quot;,&quot;\&quot;testValue\&quot;&quot;)
  }
}
// 在productFlavors中配置
productFlavors {
	flavorName {
  	buildConfigField(&quot;String&quot;, &quot;key&quot;, &quot;\&quot;value\&quot;&quot;)
	}
}
</code></pre></div><ol start="3"><li><h3 id="结合-gradle-properties-使用"><a href="#结合-gradle-properties-使用" class="header-anchor">#</a> 结合 gradle.properties 使用</h3> <p>第一步：在 gradle.properties 里定义值</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">DOMAIN</span> <span class="token punctuation">=</span> <span class="token attr-value">bhopb.cloud</span>
</code></pre></div><p>第二步：在 app/build.gradle 设置 BuildConfig</p> <div class="language- extra-class"><pre class="language-text"><code>android {
    ...
    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            buildConfigField(&quot;String&quot;,&quot;DOMAIN&quot;,&quot;\&quot;${DOMAIN}\&quot;&quot;)
        }
        debug{
            buildConfigField(&quot;String&quot;,&quot;KDOMAINY&quot;,&quot;\&quot;${DOMAIN}\&quot;&quot;)
        }
    }
    ...
}
</code></pre></div></li></ol> <h1 id="四、样式篇"><a href="#四、样式篇" class="header-anchor">#</a> 四、样式篇</h1> <h2 id="theme-主题"><a href="#theme-主题" class="header-anchor">#</a> Theme 主题</h2> <h4 id="theme-版本变化"><a href="#theme-版本变化" class="header-anchor">#</a> Theme 版本变化</h4> <table><thead><tr><th>主题</th> <th></th></tr></thead> <tbody><tr><td>android:Theme</td> <td>API 1 开始</td></tr> <tr><td>android:Theme.Holo</td> <td>API 11（android3.0） 开始</td></tr> <tr><td>android:Theme.DeviceDefault</td> <td>API 14（android4.0） 开始</td></tr> <tr><td>android:Theme.Material</td> <td>API 21（android5.0） 开始</td></tr> <tr><td>Theme.AppCompat</td> <td>兼容包 AppCompat_v7 中的主题</td></tr></tbody></table> <p>在 Android 5.0 （API 21）之后，引入了 Material Design。5.0 以上的版本，如果想用 Material Design，需要引入 support-library 支持库。</p> <h4 id="如何自定义主题颜色"><a href="#如何自定义主题颜色" class="header-anchor">#</a> 如何自定义主题颜色</h4> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-08-30-020046.png" alt="img"></p> <ol><li><strong>colorPrimary</strong> 应用的主要色调，actionBar 默认使用该颜色，Toolbar 导航栏的底色</li> <li><strong>colorPrimaryDark</strong> 应用的主要暗色调，statusBarColor 默认使用该颜色</li> <li><strong>statusBarColor</strong> 状态栏颜色，默认使用 colorPrimaryDark</li> <li><strong>colorAccent</strong> CheckBox，RadioButton，SwitchCompat 等一般控件的选中效果默认采用该颜色</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code>其他配置：
colorPrimary                     应用的主要色调，actionBar默认使用该颜色，Toolbar导航栏的底色
colorPrimaryDark             应用的主要暗色调，statusBarColor默认使用该颜色
textColorPrimary            应用的主要文字颜色，actionBar的标题文字默认使用该颜色
statusBarColor                 状态栏颜色，默认使用colorPrimaryDark
windowBackground          窗口背景颜色
navigationBarColor           底部栏颜色
colorForeground              应用的前景色，ListView的分割线，switch滑动区默认使用该颜色
colorBackground              应用的背景色，popMenu的背景默认使用该颜色
colorAccent                  CheckBox，RadioButton等一般控件的选中效果默认采用该颜色
colorControlNormal          CheckBox，RadioButton等默认状态的颜色。
editTextColor：               默认EditView输入框字体的颜色。
textColor                      Button，textView的文字颜色

// styles.xml
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Base application theme. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AppTheme<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Theme.AppCompat.Light.DarkActionBar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Customize your theme here. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>colorPrimary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@color/colorPrimary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>colorPrimaryDark<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@color/colorPrimaryDark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>colorAccent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@color/colorAccent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="如何使用主题"><a href="#如何使用主题" class="header-anchor">#</a> 如何使用主题</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span>
        <span class="token attr-name"><span class="token namespace">android:</span>allowBackup</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@mipmap/ic_launcher<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@string/app_name<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>networkSecurityConfig</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@xml/network_security_config<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>roundIcon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@mipmap/ic_launcher_round<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>supportsRtl</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@style/AppTheme<span class="token punctuation">&quot;</span></span> <span class="token attr-name">--</span> <span class="token attr-name">这里指定主题</span>

        <span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="导航栏样式"><a href="#导航栏样式" class="header-anchor">#</a> 导航栏样式</h2> <p>Android 系统的历史演变中，也出现了以下几种 Bar 的变化；</p> <p>TitleBar、ActionBar(原生)、Toolbar(支持库)、AppBar</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-08-29-234805.png" alt="è¿éåå¾çæè¿°"></p> <p>在 Android 3.0 的版本里，所有使用 Theme.Holo 主题的 Activity 都会包含 actionBar；当 app 运行在 Andriod 3.0 以下版本（不低于 Android 2.1）时，如果要添加 action bar，需要加载 Android Support 库。</p> <h3 id="如何隐藏-statusbar"><a href="#如何隐藏-statusbar" class="header-anchor">#</a> 如何隐藏 StatusBar</h3> <p>**状态栏(Status Bar)：**屏幕最上面的，显示时间等</p> <p>**导航栏(Navigation Bar)：**最下面的反馈按钮</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 隐藏title</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getSupportActionBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">getSupportActionBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="如何在-noactionbar-时向-activity-里添加-toolbar"><a href="#如何在-noactionbar-时向-activity-里添加-toolbar" class="header-anchor">#</a> 如何在 NoActionBar 时向 Activity 里添加 Toolbar</h3> <ol><li><p>引入支持库 <code>implementation 'com.android.support:appcompat-v7:28.0.0'</code></p></li> <li><p>确保 Activity 继承 AppCompatActivity</p></li> <li><p>使用 NoActionBar 的主题背景</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span>
        <span class="token attr-name"><span class="token namespace">android:</span>allowBackup</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@mipmap/ic_launcher<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@string/app_name<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>networkSecurityConfig</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@xml/network_security_config<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>roundIcon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@mipmap/ic_launcher_round<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>supportsRtl</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@style/AppTheme.NoActionBar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>向布局中，添加 toolbar</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.v7.widget.Toolbar</span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/my_toolbar<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>?attr/actionBarSize<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>?attr/colorPrimary<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>elevation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@style/ThemeOverlay.AppCompat.ActionBar<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">app:</span>popupTheme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@style/ThemeOverlay.AppCompat.Light<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li><p>在 Activity 的 onCreate 方法中，调用 Activity 的 <code>setSupportActionBar()</code> 方法，将 Toolbar 作为 ActionBar</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_my<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Toolbar</span> myToolbar <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Toolbar</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>my_toolbar<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setSupportActionBar</span><span class="token punctuation">(</span>myToolbar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="如何在导航栏添加菜单"><a href="#如何在导航栏添加菜单" class="header-anchor">#</a> 如何在导航栏添加菜单</h3> <p>1、添加菜单(新建 Menu Resource File)</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-09-13-064309.png" alt="image-20190913144308681"></p> <p>2、添加菜单 item</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>menu</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/menu_item_new_crime<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/ic_menu_send<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@string/new_crime<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>showAsAction</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ifRoom|withText<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>menu</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>3、新建菜单按钮图标</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-09-13-065038.png" alt="image-20190913145037569"></p> <p>新建 Image Asset，类型选择 Action Bar and Tab Icons，选择 Asset Type 为 Clip Art，然后从 Clip Art 里面选择；</p> <p>4、在代码里设置菜单栏</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-09-13-073153.png" alt="image-20190913153152649"></p> <h2 id="android-单位"><a href="#android-单位" class="header-anchor">#</a> Android 单位</h2> <blockquote><p>px、dp、dip、sp</p> <p>安卓的单位里常用的就是 dp、sp</p></blockquote> <p>px: 代表着像素，做过 web 端开发的应该能理解。</p> <p>density: 屏幕密度 = dpi/160;</p> <p>dpi: 每英寸点数，即每英寸包含像素个数。比如 320X480 分辨率的手机，宽 2 英寸，高 3 英寸, 每英寸包含的像素点的数量为 320/2=160dpi（横向）或 480/3=160dpi（纵向），160 就是这部手机的 dpi，横向和纵向的这个值都是相同的</p> <p>dp/dip: dp 和 dip 是同一种单位，都是指&quot;设备独立像素&quot;。在屏幕密度 dpi = 160 屏幕上，1dp = 1px</p> <p>sp: 和 dp 很类似，一般用来设置字体大小。它和 dp 的区别是，sp 会根据用户的字体大小偏好来缩放。</p> <p>安卓获取一些像素的工具类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PixelUtils</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 获取状态栏的高度
     * @param context
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getStatusBarHeight</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> resourceId <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getIdentifier</span><span class="token punctuation">(</span><span class="token string">&quot;status_bar_height&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dimen&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;android&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceId <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDimensionPixelSize</span><span class="token punctuation">(</span>resourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获得屏幕高度
     *
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getScreenWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WindowManager</span> wm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">)</span> <span class="token class-name">CApplication</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>WINDOW_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DisplayMetrics</span> outMetrics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wm<span class="token punctuation">.</span><span class="token function">getDefaultDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMetrics</span><span class="token punctuation">(</span>outMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> outMetrics<span class="token punctuation">.</span>widthPixels<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获得屏幕宽度
     *
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getScreenHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WindowManager</span> wm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">)</span> <span class="token class-name">CApplication</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>WINDOW_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DisplayMetrics</span> outMetrics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wm<span class="token punctuation">.</span><span class="token function">getDefaultDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMetrics</span><span class="token punctuation">(</span>outMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> outMetrics<span class="token punctuation">.</span>heightPixels<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dp2px</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">float</span> scale <span class="token operator">=</span> <span class="token class-name">CApplication</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>density<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>value <span class="token operator">*</span> scale <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">px2dp</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">float</span> scale <span class="token operator">=</span> <span class="token class-name">CApplication</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>density<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>value <span class="token operator">/</span> scale <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="drawable-资源"><a href="#drawable-资源" class="header-anchor">#</a> Drawable 资源</h2> <h3 id="什么是-drawable？"><a href="#什么是-drawable？" class="header-anchor">#</a> 什么是 Drawable？</h3> <p>字面上可以理解为<code>可绘制物</code>，表示可以在 Canvas 上绘制的对象。</p> <p>图片、颜色、形状都可以是 Drawable</p> <h3 id="常用的-drawable-类型"><a href="#常用的-drawable-类型" class="header-anchor">#</a> 常用的 Drawable 类型</h3> <p>① <strong>Shape Drawables</strong> - 定义具有个性化属性的形状。比如矩形、圆角矩形、椭圆等。</p> <p>② <strong>StateList Drawables</strong> - 定义用于不同状态的 Drawable。一般是 selector 类型</p> <p>③ <strong>LayerList Drawables</strong> - 定义分组在一起成为复合结果的 Drawable</p> <p>④ <strong>NinePatch Drawables</strong> - 具有可伸缩区域的 PNG 图片，以允许适当调整大小</p> <p>⑤ <strong>Vector Drawables</strong> - 定义复杂的基于 XML 的矢量图像</p> <h4 id="shape-drawable"><a href="#shape-drawable" class="header-anchor">#</a> Shape Drawable</h4> <p>在 drawable 目录下面创建一个 drawable 资源：</p> <p>stroke_shape.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>shape</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>shape</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rectangle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>corners</span> <span class="token attr-name"><span class="token namespace">android:</span>radius</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4dp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stroke</span> <span class="token attr-name"><span class="token namespace">android:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#C1E1A6<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>padding</span>
        <span class="token attr-name"><span class="token namespace">android:</span>left</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>20dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>top</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>20dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>right</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>20dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>bottom</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>20dp<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>shape</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在 textview 的 background 属性里应用：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/stroke_shape<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#ffffff<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@string/hello_world<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>drawables 可以应用于任何 View 及 ViewGroup，通常是通过 background 属性来设置 Drawable 资源的。</p> <p>eg: 一个灰色圆角的背景色</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>shape</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>shape</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rectangle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--边框颜色--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stroke</span> <span class="token attr-name"><span class="token namespace">android:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2dp<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#FFF<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--填充色--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>solid</span> <span class="token attr-name"><span class="token namespace">android:</span>color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#80FFFFFF<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>corners</span> <span class="token attr-name"><span class="token namespace">android:</span>radius</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@dimen/dip_20<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>shape</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><hr> <h4 id="statelistdrawable"><a href="#statelistdrawable" class="header-anchor">#</a> StateListDrawable</h4> <p>一般会根据不同的状态，通过多个不同的图像来表示相同的图形；</p> <p>比如设置 Button 的按下、聚焦、失焦等状态时的背景颜色。</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-10-10-123436.png" alt="img"></p> <p>场景 1:在 drawable 目录下面创建一个 xml 资源——selector_button.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selector</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>state_pressed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>state_enabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/button_pressed<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>state_focused</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>state_enabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/button_focused<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>state_enabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/button_enabled<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>state_enabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/button_disabled<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>state_focused</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>state_enabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/button_disabled_focused<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/button_normal<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selector</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>设置到<code>background</code>属性上</p> <div class="language-xml extra-class"><pre class="language-xml"><code>Button
        android:text=&quot;LifeCycle&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:textAllCaps=&quot;false&quot;
        android:background=&quot;@drawable/shape_solid&quot;
        /&gt;
</code></pre></div><p>场景 2：也可以设置不同状态下的字体颜色</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selector</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name"><span class="token namespace">android:</span>state_pressed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#ffff0000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name"><span class="token namespace">android:</span>state_focused</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#ff0000ff<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name"><span class="token namespace">android:</span>state_selected</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#ff0000ff<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name"><span class="token namespace">android:</span>color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#ff000000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selector</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>将它设置到任意<code>color</code>属性上</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>MVPActivity<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textAllCaps</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/selector_button<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p><strong>注</strong>：踩过坑的，不然会报错；</p> <p>==1、selector 作为 drawable 背景用时，item<strong>必须</strong>使用<strong>android:drawable</strong>属性指定；==</p> <p>==2、selector 作为 color 时，item<strong>必须</strong>使用<strong>android:color</strong>属性指定；==</p> <p>如何将图片应用到 selector 上? 可以直接使用图片资源</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/image<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 可以避免图片被缩放了 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bitmap</span> <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@drawable/image<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="layerlist-drawable"><a href="#layerlist-drawable" class="header-anchor">#</a> LayerList Drawable</h4> <p>可以用来绘制多个图层，后面的图层会叠加在上一个图层上面。可以通过 left/top/right/bottom 来移动图层；</p> <p>常见的使用场景：</p> <p>① [View 边框阴影]</p> <p>② [View 单边添加边框]</p> <p>③ [View 分层背景]</p> <p>④ [View 卡片背景]</p> <p>⑤ [绘制三角形]</p> <hr> <h4 id="nine-patch"><a href="#nine-patch" class="header-anchor">#</a> Nine-Patch</h4> <p>可以伸缩</p> <hr> <h4 id="colordrawable"><a href="#colordrawable" class="header-anchor">#</a> ColorDrawable</h4> <p><strong>通过代码如何获取颜色</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Resources</span> resources <span class="token operator">=</span> mContext<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Deprecate</span> <span class="token comment">// 过时了</span>
<span class="token keyword">int</span> text_selected_color <span class="token operator">=</span> resources<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span>text_pressed<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 新的方式</span>
<span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span>white<span class="token punctuation">)</span>
</code></pre></div><h4 id="bitmapdrawable"><a href="#bitmapdrawable" class="header-anchor">#</a> BitmapDrawable</h4> <p>可以通过 java 代码——<a href="https://developer.android.com/reference/android/graphics/drawable/BitmapDrawable.html" target="_blank" rel="noopener noreferrer">BitmapDrawable<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Resources</span> res <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Bitmap</span> bmp <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>adt_48<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BitmapDrawable</span> bitmapDrawable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapDrawable</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
bitmapDrawable<span class="token punctuation">.</span><span class="token function">setTileModeX</span><span class="token punctuation">(</span><span class="token class-name">TileMode</span><span class="token punctuation">.</span>MIRROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
bitmapDrawable<span class="token punctuation">.</span><span class="token function">setGravity</span><span class="token punctuation">(</span><span class="token class-name">Gravity</span><span class="token punctuation">.</span>CENTER_HORIZONTAL <span class="token operator">|</span> <span class="token class-name">Gravity</span><span class="token punctuation">.</span>BOTTOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>也可以通过 xml 来定义 bitmap 文件</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
&lt;bitmap
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:src=&quot;@[package:]drawable/drawable_resource&quot;
    android:antialias=[&quot;true&quot; | &quot;false&quot;]
    android:dither=[&quot;true&quot; | &quot;false&quot;]
    android:filter=[&quot;true&quot; | &quot;false&quot;]
    android:gravity=[&quot;top&quot; | &quot;bottom&quot; | &quot;left&quot; | &quot;right&quot; | &quot;center_vertical&quot; |
                      &quot;fill_vertical&quot; | &quot;center_horizontal&quot; | &quot;fill_horizontal&quot; |
                      &quot;center&quot; | &quot;fill&quot; | &quot;clip_vertical&quot; | &quot;clip_horizontal&quot;]
    android:mipMap=[&quot;true&quot; | &quot;false&quot;]
    android:tileMode=[&quot;disabled&quot; | &quot;clamp&quot; | &quot;repeat&quot; | &quot;mirror&quot;] /&gt;
</code></pre></div><h3 id="drawable-文件"><a href="#drawable-文件" class="header-anchor">#</a> Drawable 文件</h3> <p>我们新建一个 Android 项目后应该可以看到很多 drawable 文件夹，分别对应不同的 dpi</p> <ul><li>drawable-ldpi (dpi=120, density=0.75)</li> <li>drawable-mdpi (dpi=160, density=1)</li> <li>drawable-hdpi (dpi=240, density=1.5)</li> <li>drawable-xhdpi (dpi=320, density=2)</li> <li>drawable-xxhdpi (dpi=480, density=3)</li></ul> <p>资源寻找的流程：</p> <img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-10-10-131151.png" alt="utf-8' '4118241-b9efe56e539626c0" style="zoom:50%;"> <p>比如在一个中等分辨率的手机上，Android 就会选择 drawable-mdpi 文件夹下的图片，文件夹下有这张图就会优先被使用，在这种情况下，图片是不会被缩放的；</p> <p>但是如果没有在 drawable-mdpi 的文件夹下找到相应图片的话，Android 系统会首先从更高一级的 drawable-hdpi 文件夹中查找，如果找到图片资源就进行缩放处理，显示在屏幕上；</p> <p>如果 drawable-hdpi 文件夹下也没有的话，就依次往 drawable-xhdpi 文件夹、drawable-xxhdpi 文件夹、drawable-xxxhdpi 文件夹、drawable-nodpi；</p> <p>如果更高密度的文件夹里都没有找到，就往更低密度的文件夹里寻找，drawable-ldpi 文件夹下查找；</p> <p>如果都没找到，最终会在默认的 drawable 文件夹中寻找，如果默认的 drawable 文件夹中也没有那就会报错啦。</p> <p><strong>举个例子：</strong></p> <p>假如当前设备的 dpi 是 320，系统会优先去 drawable-xhdpi 目录查找，如果找不到，会依次查找 xxhdpi → xxxhdpi → hdpi → mdpi → ldpi。对于不存在的 drawable-[density]目录直接跳过，中间任一目录查找到资源，则停止本次查找。</p> <h4 id="dpi-范围密度对应范围"><a href="#dpi-范围密度对应范围" class="header-anchor">#</a> dpi 范围密度对应范围</h4> <table><thead><tr><th>设备密度</th> <th>适配资源文件密度</th></tr></thead> <tbody><tr><td>0dpi ~ 120dpi</td> <td>ldpi</td></tr> <tr><td>120dpi ~ 160dpi</td> <td>mdpi</td></tr> <tr><td>160dpi ~ 240dpi</td> <td>hdpi</td></tr> <tr><td>240dpi ~ 320dpi</td> <td>xhdpi</td></tr> <tr><td>320dpi ~ 480dpi</td> <td>xxhdpi</td></tr> <tr><td>480dpi ~ 640dpi</td> <td>xxxhdpi</td></tr></tbody></table> <p>对于每种密度下的 icon 应该设计成什么尺寸其实 Android 也是给出了最佳建议，建议尺寸如下表所示：</p> <table><thead><tr><th>资源文件密度</th> <th>建议尺寸</th></tr></thead> <tbody><tr><td>mipmap-mdpi</td> <td>48 * 48（实测图标 16 就够了）</td></tr> <tr><td>mipmap-hdpi</td> <td>72 * 72（博主实测图标 32 就够了）</td></tr> <tr><td>mipmap-xhdpi</td> <td>96 * 96（实测图标 48 就够了）</td></tr> <tr><td>mipmap-xxhdpi</td> <td>144 * 144（实测图标 64 就够了）</td></tr> <tr><td>mipmap-xxxhdpi</td> <td>192 * 192（博主实测图标 72 就够了）</td></tr></tbody></table> <p><strong>总体匹配规则：</strong></p> <p>如果图片所在目录 dpi 低于匹配目录，那么该图片被认为是为低密度设备需要的，现在要显示在高密度设备上，图片会被放大。</p> <p>如果图片所在目录 dpi 高于匹配目录，那么该图片被认为是为高密度设备需要的，现在要显示在低密度设备上，图片会被缩小。</p> <p>如果图片所在目录为 drawable-nodpi，则无论设备 dpi 为多少，保留原图片大小，不进行缩放。</p> <p>那么六种通用密度下的缩放倍数是多少呢？以 mdpi 为基线，各密度目录下的放大倍数（即缩放因子 density）如下</p> <table><thead><tr><th>密度</th> <th>放大倍数</th></tr></thead> <tbody><tr><td>ldpi</td> <td>0.75</td></tr> <tr><td>mdpi</td> <td>1.0</td></tr> <tr><td>hdpi</td> <td>1.5</td></tr> <tr><td>xhdpi</td> <td>2.0</td></tr> <tr><td>xxhdpi</td> <td>3.0</td></tr> <tr><td>xxxhdpi</td> <td>4.0</td></tr></tbody></table> <p>例如，当前设备的 dpi 是 480（即 xxhdpi），那么对于存放于 mdpi 目录中的图片会被放大三倍。</p> <p>缩放倍数（缩放因子）计算方法：对于任意设备，各 drawable-[density]目录下的图片放大倍数的计算公式</p> <img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-12-03-072926.png" alt="缩放因子计算公式" style="zoom:33%;"> <h3 id="res、drawable-与-mipmap-的区别"><a href="#res、drawable-与-mipmap-的区别" class="header-anchor">#</a> res、drawable 与 mipmap 的区别</h3> <h3 id=""><a href="#" class="header-anchor">#</a></h3> <h2 id="全屏处理"><a href="#全屏处理" class="header-anchor">#</a> 全屏处理</h2> <p>两种方式：一种通过 style 的 theme 主题配置；一种通过代码来控制全屏或者取消全屏；</p> <p>方法 1：xml 配置式</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AppTheme<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Theme.AppCompat.Light.DarkActionBar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android:windowFullscreen<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>方法 2：java 编程式</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//全屏</span>
<span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_FULLSCREEN<span class="token punctuation">,</span> <span class="token class-name">WindowManager</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_FULLSCREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取消全屏</span>
<span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clearFlags</span><span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_FULLSCREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="shadow-阴影的处理"><a href="#shadow-阴影的处理" class="header-anchor">#</a> Shadow 阴影的处理</h2> <blockquote><p>https://segmentfault.com/a/1190000011809297</p></blockquote> <p>方式 1：使用 elevation 属性</p> <p>方式 2：使用 translationZ 属性</p> <p>方式 3：ViewCompat 兼容</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setShadowDrawable</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">,</span> <span class="token keyword">int</span> shapeRadius<span class="token punctuation">,</span> <span class="token keyword">int</span> shadowColor<span class="token punctuation">,</span> <span class="token keyword">int</span> shadowRadius<span class="token punctuation">,</span> <span class="token keyword">int</span> offsetX<span class="token punctuation">,</span> <span class="token keyword">int</span> offsetY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">ShadowDrawable</span> drawable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShadowDrawable</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setShapeRadius</span><span class="token punctuation">(</span>shapeRadius<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setShadowColor</span><span class="token punctuation">(</span>shadowColor<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setShadowRadius</span><span class="token punctuation">(</span>shadowRadius<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOffsetX</span><span class="token punctuation">(</span>offsetX<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOffsetY</span><span class="token punctuation">(</span>offsetY<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  view<span class="token punctuation">.</span><span class="token function">setLayerType</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>LAYER_TYPE_SOFTWARE<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ViewCompat</span><span class="token punctuation">.</span><span class="token function">setBackground</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> drawable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方式 4：使用<code>.9</code> png</p> <p><code>.9</code>图的使用很简单，只需要在 drawable 里加入一张<code>.9</code>的 png，再使用以下方式即可。</p> <img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-11-28-141638.png" alt="image-20191128221638276" style="zoom:33%;"> <p>使用 <code>.9</code> 图设置的阴影，效果一般都是有保障的。不过它会作为 View 的背景被设置，所以阴影上占据 View 的大小的，所以使用图片模拟出来的阴影，View 本身的视觉效果会小。</p> <p>将一个使用 ViewCompat 实现的效果，放在一起，你就可以看到对比的效果。</p> <p><img src="https://segmentfault.com/img/remote/1460000011809317?w=214&amp;h=304" alt="/9patch-duibi.png"></p> <p>这里，两个 ImageView ，实际设置的大小，都是 100dp，但是视觉上，使用 .9 实现的效果，视觉效果就会小。</p> <p>另外：<code>.9</code> 的图，一般都是设计师会提供给我们。这里也推荐一个可以制作阴影效果的<a href="http://inloop.github.io/shadow4android/" target="_blank" rel="noopener noreferrer">在线工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="字体样式"><a href="#字体样式" class="header-anchor">#</a> 字体样式</h2> <p>如果想使用样式，请使用 textAppearance 属性</p> <p>如果单纯的指定加粗的话，使用 textStyle 属性</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
          <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@string/string_margin_safety_tip<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name"><span class="token namespace">android:</span>textAppearance</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@style/Body_Grey<span class="token punctuation">&quot;</span></span>
          <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h2 id="gravity"><a href="#gravity" class="header-anchor">#</a> Gravity</h2> <p>gravity 的中文意思就是”重心“，就是表示 view 横向和纵向的停靠位置</p> <p>（1）.**android:gravity：**是对 view 控件本身来说的，是用来设置 view 本身的内容应该显示在 view 的什么位置，默认值是左侧。也可以用来设置布局中的控件位置</p> <p>（2）.**android:layout_gravity：**是相对于包含改元素的父元素来说的，设置该元素在父元素的什么位置；</p> <p>比如 TextView: android:layout_gravity 表示 TextView 在界面上的位置，android:gravity 表示 TextView 文本在 TextView 的什么位置，默认值是左侧.</p> <h3 id="layout-gravity-失效"><a href="#layout-gravity-失效" class="header-anchor">#</a> Layout_gravity 失效</h3> <p>当父控件 android:orientation 设置成 vertical 时，layout_gravity 只有水平方向设置才起作用，如水平方向的 left ,center ,right</p> <p>当父控件 android:orientation 设置成 horizontal 时，layout_gravity 只有垂直方向设置才起作用，如垂直方向的 top,center,bottom</p> <h2 id="tablayout-怎么设置左对齐？"><a href="#tablayout-怎么设置左对齐？" class="header-anchor">#</a> TabLayout 怎么设置左对齐？</h2> <p>abMode = scrollable 模式下 tab 的 width 能正常自定义了，而且是向左对齐的</p> <h2 id="安卓适配刘海屏"><a href="#安卓适配刘海屏" class="header-anchor">#</a> 安卓适配刘海屏</h2> <p>#五、弹框篇</p> <h2 id="dialog"><a href="#dialog" class="header-anchor">#</a> Dialog</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Button</span> clk<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Dialog</span> dialog<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>

		clk <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>clk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1. 创建了dialog</span>
		dialog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dialog</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2. 显示视图</span>
		dialog<span class="token punctuation">.</span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>dialog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3. 按钮点击时显示dialog</span>
		clk<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token annotation punctuation">@Override</span>
			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				dialog<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//用户恢复对话框的状态</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>savedInstanceState <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> savedInstanceState<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;dialog_show&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			clk<span class="token punctuation">.</span><span class="token function">performClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 用于保存对话框的状态以便恢复
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> outState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>dialog <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dialog<span class="token punctuation">.</span><span class="token function">isShowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			outState<span class="token punctuation">.</span><span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;dialog_show&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			outState<span class="token punctuation">.</span><span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;dialog_show&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 在Activity销毁之前，确保对话框以关闭
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>dialog <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dialog<span class="token punctuation">.</span><span class="token function">isShowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			dialog<span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="dialogfragment"><a href="#dialogfragment" class="header-anchor">#</a> DialogFragment</h2> <blockquote><p>Android 比较推荐采用 DialogFragment 实现 Dialog。</p></blockquote> <p>原因：DialogFragment 能够完全实现 Dialog 的所有功能。并且他继承自 Fragment, 所以能复用 Fragment 的生命周期管理。</p> <p>在手机配置变化时，比如旋转屏幕后，导致 Activity 重新创建。基于 DialogFragment 的对话框可以通过 FragmentManager 管理器来自动重建，实现自动恢复的功能，但是 Dialog 不行。</p> <h3 id="使用-dialogfragment-的两种方式"><a href="#使用-dialogfragment-的两种方式" class="header-anchor">#</a> 使用 DialogFragment 的两种方式</h3> <h4 id="方式-1"><a href="#方式-1" class="header-anchor">#</a> <strong>方式 1</strong></h4> <blockquote><p><strong>继承 DialogFragment，重写 onCreateDialog(Bundle savedInstanceState)方法</strong></p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Dialog</span> <span class="token function">onCreateDialog</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> 		<span class="token class-name">AlertDialog</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;Title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;onCreateDialog&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token string">&quot;确定&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DialogInterface</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">DialogInterface</span> dialog<span class="token punctuation">,</span> <span class="token keyword">int</span> which<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">dismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setNegativeButton</span><span class="token punctuation">(</span><span class="token string">&quot;取消&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="方式-2"><a href="#方式-2" class="header-anchor">#</a> <strong>方式 2</strong></h4> <blockquote><p><strong>继承 DialogFragment，实现 onCreateView(LayoutInflater inflater, ViewGroup container) 方法</strong></p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">View</span> view <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>dialog_custom<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//视图初始化，事件监听</span>

   <span class="token keyword">return</span> view<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><h4 id="使用区别"><a href="#使用区别" class="header-anchor">#</a> <strong>使用区别</strong></h4> <p><strong>区别 1：应用场景不同</strong></p> <p>方式 1 内部其实还是使用了 Dialog.Builder,只是代替了传统的 Dialig 对话框。适用于 UI 简单的，功能单一的情况；</p> <p>方式 2 适合创建复杂的内容弹框，或者全屏展示的。</p> <p>区别 2：</p> <h4 id="调用方式"><a href="#调用方式" class="header-anchor">#</a> 调用方式</h4> <p>使用 DialogFragment 一般使用<code>show</code>和<code>dismiss</code>方式显示和隐藏。其实内部是用了<code>FragmentTransaction</code>的<code>add</code>方法和<code>remove</code>方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">FragmentManager</span> fragmentManager <span class="token operator">=</span> <span class="token function">getFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CrimePhotoDialogFragment</span> fragment <span class="token operator">=</span> <span class="token class-name">CrimePhotoDialogFragment</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>mPhotoFile<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fragment<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>fragmentManager<span class="token punctuation">,</span> PHOTO_TAG<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="dialogfragment-生命周期"><a href="#dialogfragment-生命周期" class="header-anchor">#</a> DialogFragment 生命周期</h3> <p>正常的生命周期顺序如下：</p> <div class="language- extra-class"><pre class="language-text"><code>onCreateDialog -&gt; onCreateView
</code></pre></div><h3 id="dialogfragment-样式修改："><a href="#dialogfragment-样式修改：" class="header-anchor">#</a> DialogFragment 样式修改：</h3> <p>其实，Dialog, DialogFragment, Activity 能看到的界面,都是基于 Window 显示的; 所以修改 DialogFragment 样式本质上都是修改 window。唯一不同点在于获取 window 对象的方法不同。</p> <p>Dialog 获取 window 的方法： getWindow();</p> <p>DialogFragment 获取 window 的方法: getDialog().getWindow();</p> <h4 id="修改-dialogfragment-中-window-宽度和高度"><a href="#修改-dialogfragment-中-window-宽度和高度" class="header-anchor">#</a> <strong>修改 dialogFragment 中 window 宽度和高度</strong></h4> <h1 id="六、布局篇"><a href="#六、布局篇" class="header-anchor">#</a> 六、布局篇</h1> <h2 id="activity-生命周期"><a href="#activity-生命周期" class="header-anchor">#</a> Activity 生命周期</h2> <img src="https://upload-images.jianshu.io/upload_images/215430-4bd5c7b4d06e0dac.png"> <p>上图展示了整个 Activity 所有相关的生命周期，所有的生命周期可以看成 3 种不同级别的闭环。</p> <h3 id="全局生命周期"><a href="#全局生命周期" class="header-anchor">#</a> 全局生命周期</h3> <div class="language-mermaid extra-class"><pre class="language-text"><code>graph LR
onCreate --&gt; onDestroy

</code></pre></div><p>第一种闭环：onCreate -&gt; onDestroy。当 Activity 创建时，系统会调用 activity 的 onCreate 方法；当 Activity 被销毁时，系统则会触发 onDestroy 方法，释放内存；</p> <p>通常在 onCreate 时完成下面几件事：</p> <p>1）实例化组件，并设置页面视图(setContentView)</p> <ol start="2"><li>引用已实例化的组件(findViewById)</li></ol> <p>3）为组件设置监听器</p> <p>4）访问外部数据 Model</p> <h3 id="可视化生命周期"><a href="#可视化生命周期" class="header-anchor">#</a> 可视化生命周期</h3> <div class="language-mermaid extra-class"><pre class="language-text"><code>graph LR
onStart --&gt; onStop

</code></pre></div><p>第二种闭环：onStart -&gt; onStop。当系统调用 Activity 的 onStart 方法之后，页面就可以进入可视化阶段。当 Activity 进入到 onStop 生命周期时，当前 activity 就进入到不可视阶段；</p> <h3 id="可交互生命周期"><a href="#可交互生命周期" class="header-anchor">#</a> 可交互生命周期</h3> <div class="language-mermaid extra-class"><pre class="language-text"><code>graph LR
onResume --&gt; onPause
</code></pre></div><p>第三种闭环：onResume-&gt;onPause。当 Activity 进入 onResume 时，当前 Activity 必须位于系统调用栈的最顶层，此时 Activity 可以处理一些用户的交互。当 Activity 进入 onPause 时，用户失去了与此 activity 交互的能力，界面变得不可操作。</p> <h3 id="几种生命周期变化的过程"><a href="#几种生命周期变化的过程" class="header-anchor">#</a> 几种生命周期变化的过程</h3> <ul><li><h4 id="通过返回键来跳转不同-activity"><a href="#通过返回键来跳转不同-activity" class="header-anchor">#</a> 通过返回键来跳转不同 Activity</h4></li></ul> <p>当 Activity-A 被创建时，Activity-A 经历了下面 3 个生命周期过程</p> <div class="language-mermaid extra-class"><pre class="language-text"><code>graph LR
onCreate --&gt; onStart
onStart --&gt; onResume
</code></pre></div><p>从 A 跳转到 B 时, 需要等 A 进入 onPause 生命周期之后，B 才开始进入 onCreate 生命周期，之后开始进入 B 其它的生命周期</p> <div class="language-mermaid extra-class"><pre class="language-text"><code>graph LR
A[A组件onPause] --&gt; B[B组件onCreate]
B --&gt; C[B组件onStart]
C --&gt; D[B组件onResume]
D --&gt; E[A组件onStop]

</code></pre></div><p>从 B 返回 A 组件时，B 组件先进入 onPause 周期，如果 A 组件在这段时间内没有被系统回收，那 A 组件不需要进入 onCreate 周期，直接进入到 onRestart，一直到 onResume 周期；</p> <div class="language-mermaid extra-class"><pre class="language-text"><code>graph LR
A[B页面onPause] --&gt; B[A页面restart]
B --&gt; C[A页面start]
C --&gt; D[A页面resume]
D --&gt; E[B页面Stop]
E --&gt; F[B页面destroy]
</code></pre></div><p>最后 B 进入到 onStop 周期，最后被系统销毁，进入 onDestroy 周期；</p> <ul><li><h4 id="通过-home-键跳转到系统界面再恢复时"><a href="#通过-home-键跳转到系统界面再恢复时" class="header-anchor">#</a> 通过 Home 键跳转到系统界面再恢复时</h4></li></ul> <p>当前 Activity 会经历以下几个生命周期过程：</p> <p>首先 Activity 会进入 onPause 周期，因为可能会被系统回收，所以会进入到 onSaveInstanceState 周期，再进入到 onStop 周期，然后系统会切回到系统的主页面。==注：onSaveInstanceState 需要在 onPause 之后进去，因为避免用户的输入状态没有被保存；== 如果在系统因为内存过高，回收了当前 Avtivity 的内存，那么 Activity 还会进入 onDestroy 周期；</p> <p>当用户从 Home 界面再回到当前 Activity 时：当前 Activity 会先进入到 onRestart 生命周期，==如果之前系统回收了该 Activity，那么会先进入到 onCreate 周期==； 然后进入 onStart 周期，再进入 onRestoreInstanceState 周期，最后进入到 onResume 周期，恢复视图；</p> <div class="language-mermaid extra-class"><pre class="language-text"><code>graph TD
onPause --&gt; onSaveInstanceState
onSaveInstanceState --&gt; onStop
onStop --&gt; 离开
离开 -.-&gt;  onDestory

恢复 -.-&gt; onCreate
onCreate -.-&gt; onRestart
onRestart --&gt; onStart
onStart --&gt; onRestoreInstanceState
onRestoreInstanceState --&gt; onResume

</code></pre></div><ul><li><h4 id="设备旋转时"><a href="#设备旋转时" class="header-anchor">#</a> 设备旋转时</h4></li></ul> <p>设备旋转时，系统会销毁当前 Activity 实例，然后创建一个新的 Activity 实例。</p> <p>原理：</p> <p><code>设置配置</code>是用来描述设备当前状态的一系列特征。特征包括：屏幕方向、屏幕密度、屏幕尺寸、键盘类型、底座模式、语言等。</p> <p>==在应用运行时，只要<code>设备配置</code>发生了改变，Android 就会销毁当前 Activity，重新创建新的 activity。==</p> <p>因次，当屏幕发生旋转时，方向改变了，所以设备配置发生了变化，因此 activity 会重新创建。</p> <p>整个 activity 的生命周期过程如下：</p> <div class="language-mermaid extra-class"><pre class="language-text"><code>graph LR
onPause --&gt; onSaveInstanceState
onSaveInstanceState --&gt; onStop
onStop --&gt; onCreate
onCreate --&gt; onStart
onStart --&gt; onRestoreSavedInstance
</code></pre></div><h3 id="几种在页面里初始化组件的方式以及区别"><a href="#几种在页面里初始化组件的方式以及区别" class="header-anchor">#</a> 几种在页面里初始化组件的方式以及区别</h3> <h4 id="方式-1：layoutinflater"><a href="#方式-1：layoutinflater" class="header-anchor">#</a> 方式 1：LayoutInflater;</h4> <p>layoutInflater 是一个将 xml 布局文件转换为 View 对象的工具</p> <ol><li><h3 id="获取-layoutinflater"><a href="#获取-layoutinflater" class="header-anchor">#</a> 获取 LayoutInflater</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">LayoutInflater</span> inflater <span class="token operator">=</span> <span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><h4 id="将-layout-转化为-view"><a href="#将-layout-转化为-view" class="header-anchor">#</a> 将 Layout 转化为 View</h4> <div class="language-java extra-class"><pre class="language-java"><code>convertView <span class="token operator">=</span> mLayoutInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>layout_grid_item<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <h4 id="方式-2-findviewbyid"><a href="#方式-2-findviewbyid" class="header-anchor">#</a> 方式 2: findViewById</h4> <p>方式 3：</p> <h2 id="viewpager-的使用"><a href="#viewpager-的使用" class="header-anchor">#</a> ViewPager 的使用</h2> <p>ViewPager 的 Adapter 有三种：PageAdapter、FragmentPagerAdapter、FragmentStatePagerAdapter</p> <h3 id="pageadapter"><a href="#pageadapter" class="header-anchor">#</a> PageAdapter</h3> <h3 id="fragment-结合-viewpager"><a href="#fragment-结合-viewpager" class="header-anchor">#</a> Fragment 结合 ViewPager</h3> <p>通过<code>FragmentPagerAdapter</code>可以将<code>Fragment</code>和<code>ViewPager</code>结合起来使用。</p> <h2 id="tablayout"><a href="#tablayout" class="header-anchor">#</a> TabLayout</h2> <p>tablayout 是单独的 design support 中, 想要用 tablayout, 需要在 gradle 里单独引用他</p> <div class="language- extra-class"><pre class="language-text"><code>implementation 'com.android.support:design:28.0.0-rc02'
</code></pre></div><h3 id="简单使用"><a href="#简单使用" class="header-anchor">#</a> 简单使用</h3> <p>1）在布局文件中声明 Tablayout</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>vertical<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.design.widget.TabLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/tabLayout<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li>在 Activity 或者 Fragment 的 onCreate 周期中，手动创建 tab，并且绑定 tab clickListener</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_tab_layout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mTabLayout <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TabLayout</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tabLayout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加多个tab</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> title<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TabLayout</span><span class="token punctuation">.</span><span class="token class-name">Tab</span> tab <span class="token operator">=</span> mTabLayout<span class="token punctuation">.</span><span class="token function">newTab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tab<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>title<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mTabLayout<span class="token punctuation">.</span><span class="token function">addTab</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 给tab设置点击事件</span>
    mTabLayout<span class="token punctuation">.</span><span class="token function">setOnTabSelectedListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TabLayout</span><span class="token punctuation">.</span><span class="token class-name">OnTabSelectedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onTabSelected</span><span class="token punctuation">(</span><span class="token class-name">TabLayout</span><span class="token punctuation">.</span><span class="token class-name">Tab</span> tab<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">[</span>tab<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onTabUnselected</span><span class="token punctuation">(</span><span class="token class-name">TabLayout</span><span class="token punctuation">.</span><span class="token class-name">Tab</span> tab<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onTabReselected</span><span class="token punctuation">(</span><span class="token class-name">TabLayout</span><span class="token punctuation">.</span><span class="token class-name">Tab</span> tab<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="结合-viewpager-使用"><a href="#结合-viewpager-使用" class="header-anchor">#</a> 结合 ViewPager 使用</h3> <p>使用思路：在布局文件里声明 tabLayou 和 viewPager；当 tab 切换时，通过事件触发 viewPager 改变，</p> <p>当 viewPager 进行改变时，也通过事件来切换 tab；</p> <p>viewPager 的使用介绍结合上一章来看；</p> <ol><li>先在布局文件中放好 TabLayout 和 ViewPager；</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code>...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.design.widget.TabLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/tab<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>?attr/actionBarSize<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>tabIndicatorColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@color/colorPrimaryDark<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>tabIndicatorHeight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3dp<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.v4.view.ViewPager</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/tab_view_pager<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
...
</code></pre></div><p>2）设置 TabLayout 和 ViewPager 相互关联</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TabViewActivity</span> <span class="token keyword">extends</span> <span class="token class-name">BaseCoreActivity</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Fragment</span><span class="token punctuation">&gt;</span></span> mFragment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_tab_view<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 1. 声明布局中的tablayout</span>
      mTabLayout <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tab<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 2. 声明viewpager</span>
      mViewPager <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tab_view_pager<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 3. 初始化fragments</span>
      <span class="token function">initFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 4. 为viewPager声明FragmentPagerAdapter类的实例</span>
      mViewPager<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TabFragmentPagerAdapter</span><span class="token punctuation">(</span>mFragment<span class="token punctuation">,</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 5. 设置tabLayout的启动viewPager,这个方法会创建tab，并且重置title</span>
      mTabLayout<span class="token punctuation">.</span><span class="token function">setupWithViewPager</span><span class="token punctuation">(</span>mViewPager<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 6. 最后设置每个tab的text</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> TAB_TITLES<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mTabLayout<span class="token punctuation">.</span><span class="token function">getTabAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>TAB_TITLES<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 添加Fragment
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> TAB_TITLES<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mFragment<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TabFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>设置 viewPager 和 tabLayout 的结合</li></ol> <div class="language-java extra-class"><pre class="language-java"><code>viewPager<span class="token punctuation">.</span><span class="token function">addOnPageChangeListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ViewPager</span><span class="token punctuation">.</span><span class="token class-name">OnPageChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPageScrolled</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">float</span> positionOffset<span class="token punctuation">,</span> <span class="token keyword">int</span> positionOffsetPixels<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token punctuation">}</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPageSelected</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 重新获取视图, 只用一个recyclerView来切换数据源</span>
  type <span class="token operator">=</span> position<span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
    recyclerView<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>blockRewardAdapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
   <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
    recyclerView<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>inviteRewardAdapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
   <span class="token keyword">default</span><span class="token operator">:</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPageScrollStateChanged</span><span class="token punctuation">(</span><span class="token keyword">int</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
viewPager<span class="token punctuation">.</span><span class="token function">setCurrentItem</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="fragment"><a href="#fragment" class="header-anchor">#</a> Fragment</h2> <blockquote><p>首先介绍一下 Fragment:</p> <p>Fragment 可以展示整个屏幕或者屏幕的某一部分 UI，由 activity 来托管；Fragment 可以灵活的应用在不同的地方，不会受到限制。</p></blockquote> <h3 id="使用-fragment-的两种方式"><a href="#使用-fragment-的两种方式" class="header-anchor">#</a> 使用 Fragment 的两种方式</h3> <ul><li><h4 id="一、xml-静态添加-fragment"><a href="#一、xml-静态添加-fragment" class="header-anchor">#</a> 一、xml 静态添加 Fragment</h4> <p>静态添加 fragment 分几个步骤：</p> <p>1.在 activity.xml 布局文件里声明 fragment</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>horizontal<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token comment">&lt;!-- android:name 属性指定要在布局中实例化的 Fragment 类 --&gt;</span>
    <span class="token comment">&lt;!-- fragment必须用id或者tag作为唯一标识。--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.example.news.ArticleListFragment<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/list<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0dp<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.example.news.ArticleReaderFragment<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/viewer<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0dp<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>当系统创建这个 activity 时，会去实例化 Fragment 的类，并且调用它的 onCreateView()方法,来替换这个 fragment。</p> <p>2.创建一个类，继承 fragment 类，重写 onCreateView</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ExampleFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span>
                             <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Inflate the layout for this fragment</span>
        <span class="token keyword">return</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>example_fragment<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3.创建 fragment 的布局 xml ，此处代码省略</p></li></ul> <ul><li><h4 id="二、动态添加-fragment"><a href="#二、动态添加-fragment" class="header-anchor">#</a> 二、动态添加 Fragment</h4> <p>动态添加 fragment 的方式是唯一可以在运行时控制 fragment 的方式。我们可以通过代码编程，将 fragment 动态添加、替换、删除。动态添加分为以下几个步骤：</p> <p>1 定义容器视图</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 虽然是动态添加fragment，但是也需要在Activity的视图中为fragment安排位置 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/fragment_container<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用 FrameLayout 来作为 fragment 的容器视图，一个托管的 Activity 可以有多个容器视图。</p> <p>FrameLayout 是最简单的 ViewGroup 组件，它不以特定的方式来安排子视图的位置；</p> <p>FrameLayout 子视图的位置排列取决于他们各自的 android:layout_gravity 属性</p></li></ul> <ol start="2"><li><p>创建 fragment 类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CrimeListFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">RecyclerView</span> mRecyclerView<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CrimeBean</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token class-name">CrimeAdapter</span> mCrimeAdapter<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CrimeListFragment</span> <span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CrimeListFragment</span> fragment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CrimeListFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> fragment<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * onCreate方法是public的，需要被托管的Activity调用
   * onCreate方法并没有创建fragment视图，视图是在onCreateView里创建的
   * @param savedInstanceState
   */</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    list <span class="token operator">=</span> <span class="token class-name">DataServer</span><span class="token punctuation">.</span><span class="token function">getCrimes</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * inflater和container是用来生成fragment视图的必须参数
   * savedInstanceState可以用来恢复视图数据
   * @param inflater
   * @param container
   * @param savedInstanceState
   * @return
   */</span>
  <span class="token annotation punctuation">@Nullable</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">View</span> view <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment_crime_list<span class="token punctuation">,</span> container<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mRecyclerView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>rv_crime_list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mRecyclerView<span class="token punctuation">.</span><span class="token function">setLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> view<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mCrimeAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CrimeAdapter</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mRecyclerView<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>mCrimeAdapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mCrimeAdapter<span class="token punctuation">.</span><span class="token function">setOnItemClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre><code>@Override
public void onActivityResult(int requestCode, int resultCode, Intent data) {
super.onActivityResult(requestCode, resultCode, data);
}
</code></pre></div><p>}</p> <div class="language- extra-class"><pre class="language-text"><code>
</code></pre></div></li> <li><p>获取 fragmentManager，添加 fragment 到 Activity 中</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CrimeActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_crime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//    获取fragmentManager</span>
    <span class="token class-name">FragmentManager</span> fragmentManager <span class="token operator">=</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//    通过fragmentManager找到内存中的fragment</span>
    <span class="token class-name">Fragment</span> fragment <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">findFragmentById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_container<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fragment <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fragment <span class="token operator">=</span> <span class="token class-name">CrimeListFragment</span><span class="token punctuation">.</span><span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 开启事物</span>
      <span class="token class-name">FragmentTransaction</span> fragmentTransaction <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fragmentTransaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_container<span class="token punctuation">,</span> fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// 提交事物</span>
      fragmentTransaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="fragment-的事物管理"><a href="#fragment-的事物管理" class="header-anchor">#</a> Fragment 的事物管理</h3> <p>事物的顺序：beginTransaction —&gt; add/remove/replace... —&gt; commit</p> <h3 id="fragment-的生命周期"><a href="#fragment-的生命周期" class="header-anchor">#</a> Fragment 的生命周期</h3> <p>fragment 的生命周期类似于 activity，但是它的生命周期不是由系统来管理，而是由 Activity 来管理。具体如下图：</p> <img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-02-16-093751.png" alt="img" style="zoom:90%;"> <p>当向运行中的 Activity 添加 fragment 时，FragmentManger 会立即执行 fragment 的必要方法，保持 fragment 和 Activity 两者状态一致。以下方法会依次被调用：</p> <ul><li>onAttach(Activity)</li> <li>onCreate(Bundle):</li> <li>onCreateView(...): 系统会在 Fragment 首次绘制时调用此方法。如果需要绘制 UI，需要在这个方法里返回 UI 的根视图</li> <li>onActivityCreated(Bundle)</li> <li>onStart</li> <li>onResume</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hb<span class="token punctuation">.</span>cfdbase<span class="token punctuation">.</span>baselib<span class="token punctuation">.</span>mvp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>content</span><span class="token punctuation">.</span><span class="token class-name">Context</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os</span><span class="token punctuation">.</span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Nullable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>v4<span class="token punctuation">.</span>app</span><span class="token punctuation">.</span><span class="token class-name">Fragment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view</span><span class="token punctuation">.</span><span class="token class-name">LayoutInflater</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view</span><span class="token punctuation">.</span><span class="token class-name">View</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view</span><span class="token punctuation">.</span><span class="token class-name">ViewGroup</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>hb<span class="token punctuation">.</span>cfdbase<span class="token punctuation">.</span>baselib<span class="token punctuation">.</span>utils</span><span class="token punctuation">.</span><span class="token class-name">DebugLog</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * 抽象fragment
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">View</span> rootView<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">BaseFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 放一个bundler对象，避免arguments是null；</span>
		<span class="token function">setArguments</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token annotation punctuation">@Nullable</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>rootView <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">setRootView</span><span class="token punctuation">(</span><span class="token function">createView</span><span class="token punctuation">(</span>inflater<span class="token punctuation">,</span> container<span class="token punctuation">,</span> savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">executeOnceAfterCreateView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>rootView<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ViewGroup</span><span class="token punctuation">)</span> rootView<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeView</span><span class="token punctuation">(</span>rootView<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> rootView<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 这个不会由Fragment自身的生命周期发起 而是由 {@link android.support.v4.app.FragmentPagerAdapter}
	 * 和 {@link android.support.v4.app.FragmentStatePagerAdapter} 来调用，所以一般情况下，只有在ViewPager
	 * 中才会有
	 *
	 * @param isVisibleToUser
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserVisibleHint</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isVisibleToUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setUserVisibleHint</span><span class="token punctuation">(</span>isVisibleToUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------  userVisible:&quot;</span> <span class="token operator">+</span> isVisibleToUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 在Fragment show hide 的时候被调用，但是第一次不会调用.
	 * 可以查看{@link android.support.v4.app.FragmentManager} 源码，了解调用时机
	 *
	 * @param hidden
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onHiddenChanged</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> hidden<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onHiddenChanged</span><span class="token punctuation">(</span>hidden<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Fragment</span><span class="token punctuation">&gt;</span></span> childFragments <span class="token operator">=</span> <span class="token function">getChildFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>childFragments <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Fragment</span> item <span class="token operator">:</span> childFragments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">isAdded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// 设置子fragment的可见性</span>
					item<span class="token punctuation">.</span><span class="token function">onHiddenChanged</span><span class="token punctuation">(</span>hidden <span class="token operator">||</span> item<span class="token punctuation">.</span><span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------ hidden:&quot;</span> <span class="token operator">+</span> hidden<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * fragment初始化视图。
	 * 基本实现： inflater.inflate(R.layout.example_fragment, container, false);
	 *
	 * @param inflater
	 * @param container
	 * @param savedInstanceState
	 * @return
	 */</span>
	<span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">View</span> <span class="token function">createView</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 自定义回调
	 */</span>
	<span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">executeOnceAfterCreateView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAttach</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onActivityCreated</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onActivityCreated</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestroyView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroyView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setRootView</span><span class="token punctuation">(</span><span class="token class-name">View</span> rootView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>rootView <span class="token operator">=</span> rootView<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getRootView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> rootView<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-02-27-033253.png" alt="image-20200227113253527"></p> <h3 id="getsupportfragmentmanager、getchildfragmentmanager-的区别"><a href="#getsupportfragmentmanager、getchildfragmentmanager-的区别" class="header-anchor">#</a> getSupportFragmentManager、getChildFragmentManager 的区别</h3> <p>getChildFragmentManager： 返回一个私有的 FragmentManager，这个 manager 是属于当前 Fragment 内部的</p> <p>getSupportFragmentManager： 返回 Activity 的 FragmentManager，他能管理属于 Activy 的 fragment。</p> <p>所以主要的不同点在于：每个 Fragment 有他们自己内部的<code>FragmentManager</code>，他们能管理自己内部的<code>Fragment</code>。但是其他 FragmentManager 能管理整个 activity 的。</p> <h3 id="fragment-和-activity-间传递消息"><a href="#fragment-和-activity-间传递消息" class="header-anchor">#</a> Fragment 和 Activity 间传递消息</h3> <p>==官方推荐通过 Fragment.setArguments(Bundle bundle) 来传值==，</p> <p>Fragment 跳转不是通过 Intent 的，有自己的一套体系；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 1. 声明FragmentManager</span>
<span class="token class-name">FragmentManager</span> fragmentManager <span class="token operator">=</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 定义Bundle 设置参数</span>
<span class="token class-name">Bundle</span> klineBundle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
klineBundle<span class="token punctuation">.</span><span class="token function">putSerializable</span><span class="token punctuation">(</span><span class="token class-name">AppData</span><span class="token punctuation">.</span>INTENT<span class="token punctuation">.</span>COINPAIR<span class="token punctuation">,</span> coinPairBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
klineBundle<span class="token punctuation">.</span><span class="token function">putSerializable</span><span class="token punctuation">(</span><span class="token class-name">AppData</span><span class="token punctuation">.</span>INTENT<span class="token punctuation">.</span>SIDE<span class="token punctuation">,</span> currentSide<span class="token punctuation">)</span><span class="token punctuation">;</span>
klineFragment<span class="token punctuation">.</span><span class="token function">setArguments</span><span class="token punctuation">(</span>klineBundle<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 向Activity添加Fragment</span>
<span class="token class-name">FragmentTransaction</span> fragmentTransaction <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fragmentTransaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>kline_view<span class="token punctuation">,</span> klineFragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
fragmentTransaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4. 在fragment里通过argments获取参数</span>
<span class="token class-name">Bundle</span> arguments <span class="token operator">=</span> <span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CoinPairBean</span> coinPairBean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CoinPairBean</span><span class="token punctuation">)</span> arguments<span class="token punctuation">.</span><span class="token function">getSerializable</span><span class="token punctuation">(</span><span class="token class-name">AppData</span><span class="token punctuation">.</span>INTENT<span class="token punctuation">.</span>COINPAIR<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fragment-懒加载"><a href="#fragment-懒加载" class="header-anchor">#</a> Fragment 懒加载</h3> <blockquote><p>https://www.jianshu.com/p/0e2d746e3a3d</p></blockquote> <p>懒加载的由来：</p> <p>Fragment 最常见的两种使用方式就是 ViewPager 嵌套 Fragment ，以及直接通过 FragmentManager 来管理 Fragment。</p> <p>Fragment 在创建的整个过程会走完从<code>onAttach()</code>到<code>onResume()</code>的生命周期方法，一般情况我们无非在这里几个生命周期方法（例如 <code>onActivityCreated()</code>）里发起默认的网络请求。</p> <p>但是如果每个 Fragment 都有默认的网络请求操作（也可能是其它耗时操作，这里以网络请求为例），那么多个在 Fragment 创建过程中都会执行默认网络请求，无论 Fragment 是否对用户可见，这样有浪费流量、影响性 App 性能、用户体验不佳等缺点。</p> <p>我们要做的事情就是让 Fragment 按需加载数据，即对用户可见时再请求数据，让数据的请求时机可控，而不是在初始化创建过程中直接请求数据，同时不受嵌套层级的影响！</p> <p>所以问题的原因显而易见，既然不能在 Fragment 生命周期方法直接请求数据，所以就要另谋它法。</p> <p>版本 1：</p> <p>核心逻辑就是在 onActivityCreated 生命周期里判断是否可见</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onActivityCreated</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onActivityCreated</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
		isViewCreated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token comment">// 页面可见</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getUserVisibleHint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isLoadDataCompleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">lazyLoadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

</code></pre></div><p>版本2：</p> <p>但是版本1的问题在于，如果有多层Fragment嵌套关系。比如下面所示</p> <div class="language- extra-class"><pre class="language-text"><code>
├── fragment1-1
├── fragment1-2
│   ├── fragment2-1
│   ├── fragment2-2
│   └── fragment2-3
└── fragment1-3
    ├── fragment3-1
    ├── fragment3-2
    └── fragment3-3
</code></pre></div><p>实际上<code>fragment1-1</code>、<code>fragment2-1</code>、<code>fragment3-1</code>都会去加载数据。因为默认这些fragment都会被setUserVisibleHint(true)。</p> <p>所以，需要增加以下对parentFragment的判断。</p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token comment">/**
	 * 要同时对它的parent是否可见进行判断
	 *
	 * @return
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">realHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getParentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getParentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">LazyLoadFragment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">LazyLoadFragment</span><span class="token punctuation">)</span> <span class="token function">getParentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">realHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">getParentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="-2"><a href="#-2" class="header-anchor">#</a></h3> <p>版本3：</p> <p>FragmentManager 管理 Fragment 时，和 ViewPager 嵌套 Fragment 中的问题类似，但此时<code>setUserVisibleHint()</code>方法并不会被调用，所以要寻找新的途径了。</p> <p>当用 FragmentManager 来 <code>add()</code>、<code>hide()</code>、<code>show()</code> Fragment 时 Fragment 的<code>onHiddenChanged(boolean hidden)</code>方法会被调用，其中<code>hidden</code>参数为<code>false</code>时代表对应 Fragment 可见，否则不可见，</p> <p>全部代码</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 用于Fragment在viewpager中嵌套时懒加载 以及对于Fragment显示隐藏的回调监控
 * &lt;p&gt;
 * ================================================
 */</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">LazyLoadFragment</span> <span class="token keyword">extends</span> <span class="token class-name">BaseFragment</span> <span class="token punctuation">{</span>

	<span class="token comment">// 界面是否已创建完成</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> isViewCreated<span class="token punctuation">;</span>

	<span class="token comment">// 数据是否已请求</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> isLoadDataCompleted<span class="token punctuation">;</span>

	<span class="token comment">// 是否对用户可见</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> isVisibleToUser <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * viewpager会调用这个方法
	 * @param isVisibleToUser
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserVisibleHint</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isVisibleToUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setUserVisibleHint</span><span class="token punctuation">(</span>isVisibleToUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isVisibleToUser <span class="token operator">&amp;&amp;</span> isViewCreated <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isLoadDataCompleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">lazyLoadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isViewCreated <span class="token operator">&amp;&amp;</span> <span class="token function">isAdded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">setVisibleChanged</span><span class="token punctuation">(</span>isVisibleToUser <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">realHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * fragmetnManager会调用这个方法
	 * @param hidden
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onHiddenChanged</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> hidden<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onHiddenChanged</span><span class="token punctuation">(</span>hidden<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">setVisibleChanged</span><span class="token punctuation">(</span><span class="token operator">!</span>hidden<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * {@link #isVisible()}
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isAdded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">setVisibleChanged</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">realHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">getUserVisibleHint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isAdded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">setVisibleChanged</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 要同时对他的parent进行计算
	 *
	 * @return
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">realHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getParentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getParentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">LazyLoadFragment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">LazyLoadFragment</span><span class="token punctuation">)</span> <span class="token function">getParentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">realHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">getParentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onActivityCreated</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onActivityCreated</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
		isViewCreated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getUserVisibleHint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isLoadDataCompleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">lazyLoadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">lazyLoadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		isLoadDataCompleted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 没有使用 {@link #setUserVisibleHint(boolean)} 是因为它会公布到Fragment外部调用，混在一起太混乱了
	 *
	 * @param visible
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setVisibleChanged</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> visible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 解决重复调用问题</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isVisibleToUser <span class="token operator">==</span> visible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		isVisibleToUser <span class="token operator">=</span> visible<span class="token punctuation">;</span>
		<span class="token function">onVisibleChanged</span><span class="token punctuation">(</span>visible<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 向子类通知Fragment的可见性变化 回调
	 *
	 * @param visible
	 */</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onVisibleChanged</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> visible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;------enter------  visible:&quot;</span> <span class="token operator">+</span> visible<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="constraintlayout"><a href="#constraintlayout" class="header-anchor">#</a> ConstraintLayout</h2> <p>约束布局</p> <h2 id="splashscreen"><a href="#splashscreen" class="header-anchor">#</a> SplashScreen</h2> <p>一般 app 从 click 启动，到进入 MainActivity，中间会有一段空白页面的时间。这一段时间，一般系统会用来做初始化工作的。在一个 Activity 打开时，如果该 Activity 所属的 Application 还没有启动，系统会为这个 Activity 创建一个进程；每创建一个进程，都会执行一次 Application 的 onCreate()方法；在 Application 的 onCreate 方法中执行耗时间的操作，就会出现白屏。</p> <p>如果空白的时间太长，会降低客户的体验效果。所以一般我们会在 app 启动后加一个 SplashActivity，用来做缓冲。</p> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>.app.Application<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>allowBackup</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>hardwareAccelerated</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@mipmap/ic_launcher<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@string/app_name<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>largeHeap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>roundIcon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@mipmap/ic_launcher<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>supportsRtl</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@style/AppTheme<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>networkSecurityConfig</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@xml/network_security_config<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">tools:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android:label,android:icon,android:theme,android:allowBackup,android:supportsRtl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   			<span class="token comment">&lt;!-- 指明样式主题 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>.main.ui.SplashActivity<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>screenOrientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>portrait<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@style/SplashTheme<span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 告诉app，SplashActivity是启动后第一个进入的主页面 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android.intent.action.MAIN<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android.intent.category.LAUNCHER<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一般 Splash 的屏幕都是全屏的页面，所以在设置好 SplashActivity 后，我们还需要设置一下 SplashTheme，来设置一下页面的样式。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SplashTheme<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Theme.AppCompat.Light.NoActionBar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 设置window的背景图片，默认是白屏 --&gt;</span>
  <span class="token comment">&lt;!-- 另外：除了图片，也可以设置drawable，不过我还不会用drawable画一个页面出来 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android:windowBackground<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@mipmap/launch_bg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 设置全屏，默认是false --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android:windowFullscreen<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android:fitsSystemWindows<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android:windowNoTitle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android:clipToPadding<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android:windowTranslucentNavigation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>



</code></pre></div><p>在 SplashActivity 里，一般还会判断做一下引导页和倒计时欢迎页面；引导页只在安装后第一次使用时出现。</p> <div class="language-java extra-class"><pre class="language-java"><code>在<span class="token class-name">Activity</span>的onCreate里判断
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">startApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> firstlaunch <span class="token operator">=</span> <span class="token class-name">SPEx</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;firstlaunch&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstlaunch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">SPEx</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;firstlaunch&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BootPageActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">WelcomeActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>倒计时欢迎页面关键代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Handler</span> mHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 跳转到主页面</span>
      <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>act<span class="token punctuation">,</span> <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//执行一次后销毁本页面</span>
      <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 在onResume或者其他生命周期方法里调用</span>
mHandler<span class="token punctuation">.</span><span class="token function">sendEmptyMessageDelayed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 倒计时n秒</span>

  <span class="token comment">/** 这种方式也可以
  new Handler().postDelayed(new Runnable() {
            @Override
            public void run() {
                Intent intent=new Intent(act, MainActivity.class);
                startActivity(intent);
                finish();
            }
        }, 3000);**/</span>
</code></pre></div><p><strong>踩坑</strong>：需要注意的是，有一些教程让配置：android:windowIsTranslucent 为 true
他的原理是将背景颜色设置为透明色，在启动页出现前屏幕一直显示桌面。这样会给人一种 app 没有点到的错觉，不建议设置。</p> <h1 id="七、列表"><a href="#七、列表" class="header-anchor">#</a> 七、列表</h1> <h3 id="_1-listview"><a href="#_1-listview" class="header-anchor">#</a> 1.ListView</h3> <h4 id="视图："><a href="#视图：" class="header-anchor">#</a> 视图：</h4> <p>在 xml 里声明一个 ListView 控件</p> <h4 id="适配器："><a href="#适配器：" class="header-anchor">#</a> 适配器：</h4> <p><strong>Adapter</strong>: 创建一个<code>MyListAdapter</code>继承<code>BaseAdapter</code>，也可以用 Android 自带的<code>ArrayAdapter</code>;</p> <p>将 listView 的适配器设置为此处创建的 Adapter 实例；</p> <h4 id="监听器"><a href="#监听器" class="header-anchor">#</a> 监听器:</h4> <p>clickListener：如果需要对 list-item 的点击事情做监听，可以在 listView 的实例上添加 onItemClickListener;</p> <p>代码：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>.views.list.ui.ListViewActivity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ListView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/lv<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>divider</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@color/colorPrimary<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>dividerHeight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>scrollbars</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>none<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_list_view<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mlv <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>lv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里的例子是用了ArrayAdapter，需要传list-item的视图，list—item_text的id，数组</span>
    adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>layout_list_item_text<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>lv_item_text<span class="token punctuation">,</span> datas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mlv<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mlv<span class="token punctuation">.</span><span class="token function">setOnItemClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ListView</span><span class="token punctuation">.</span><span class="token class-name">OnItemClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token annotation punctuation">@Override</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onItemClick</span><span class="token punctuation">(</span><span class="token class-name">AdapterView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parent<span class="token punctuation">,</span> <span class="token class-name">View</span> view<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">ListViewActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> datas<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>自定义 Adapter</p> <div class="language- extra-class"><pre class="language-text"><code>
</code></pre></div><h3 id="_2-gridview"><a href="#_2-gridview" class="header-anchor">#</a> 2.GridView</h3> <blockquote><p>GridView 和 ListView 的用法基本一致，只是布局变化了，会以宫格的形式展示。</p> <p>GridView 可以结合 BaseAdapter 使用，也可以结合 SimpleAdapter 使用</p></blockquote> <ul><li><h4 id="_2-1-结合-baseadapter"><a href="#_2-1-结合-baseadapter" class="header-anchor">#</a> 2.1 结合 BaseAdapter</h4></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">GridViewAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">BaseAdapter</span> <span class="token punctuation">{</span> <span class="token comment">// 自己写一个Adapter类，继承BaseAdapter</span>

   <span class="token keyword">private</span> <span class="token class-name">Context</span> context<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">Inflater</span> mInflater

   <span class="token keyword">public</span> <span class="token class-name">GridViewAdapter</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	 <span class="token keyword">this</span><span class="token punctuation">.</span>mInflater <span class="token operator">=</span> <span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getView</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token class-name">View</span> convertView<span class="token punctuation">,</span> <span class="token class-name">ViewGroup</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这个地方是返回一个视图</span>
    <span class="token comment">// 第一种：不做任何处理，每次都重新创建view</span>
    <span class="token class-name">View</span> view <span class="token operator">=</span> mInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_filter_exchange_list<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TextView</span> textView <span class="token operator">=</span> convertView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>exch_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    textView<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getExch_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> view<span class="token punctuation">;</span>

    <span class="token comment">// 第二种：通过converView来</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>convertView <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      convertView <span class="token operator">=</span> mInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_filter_exchange_list<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">TextView</span> textView <span class="token operator">=</span> convertView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>exch_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    textView<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getExch_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> convertView<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li><h4 id="_2-2-结合-simpleadapter"><a href="#_2-2-结合-simpleadapter" class="header-anchor">#</a> 2.2 结合 SimpleAdapter</h4></li></ul> <h3 id="_3-recyclerview"><a href="#_3-recyclerview" class="header-anchor">#</a> 3.RecyclerView</h3> <blockquote><p>RecyclerView 是 GroupView 的子类，每一个列表项都作为一个 View 的对象来显示。</p></blockquote> <p>RecyclerView 需要 Adapter 和 ViewHolder 结合来使用</p> <ul><li><h4 id="adapter-的作用"><a href="#adapter-的作用" class="header-anchor">#</a> Adapter 的作用</h4></li></ul> <p>每一个 listview 都需要 adapter。在 RecyclerView 里，adapter 负责两件事情：</p> <ol><li>创建必要的 ViewHolder 以及对应的视图，提供给 RecyclerView</li> <li>负责根据传入的位置，找到对应的 model，绑定到 ViewHolder 上；</li></ol> <p>Adapter 的实现步骤：</p> <p>a.创建一个 Adapter 继承 RecyclerView.Adapter，在 Adapter 里实现对应的方法。</p> <p>b.创建 ViewHolder 继承 RecyclerView.ViewHolder</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// RecyclerView.Adapter实现代码</span>
<span class="token comment">// 可以自定义一个ViewHolder的类，传入给Adapter作为泛型。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecyclerViewAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView</span><span class="token punctuation">.</span><span class="token class-name">Adapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RecyclerViewAdapter</span><span class="token punctuation">.</span><span class="token class-name">MyViewHodler</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">LayoutInflater</span> myLayoutInflater<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Context</span> mContext<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>


  <span class="token keyword">public</span> <span class="token class-name">RecyclerViewAdapter</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
    myLayoutInflater <span class="token operator">=</span> <span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 自定义的ViewHolder类</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyViewHodler</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView</span><span class="token punctuation">.</span><span class="token class-name">ViewHolder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">TextView</span> textView<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">MyViewHodler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">View</span> itemView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span>itemView<span class="token punctuation">)</span><span class="token punctuation">;</span>
      textView <span class="token operator">=</span> itemView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>rcv_text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">RecyclerView</span><span class="token punctuation">.</span><span class="token class-name">ViewHolder</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewGroup</span> viewGroup<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这个方法是为了个每一个item从layout文件inflate出一个view。</span>
    <span class="token comment">// 这个方法的返回对象是一个ViewHolder.</span>
    <span class="token class-name">View</span> view <span class="token operator">=</span> myLayoutInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>layout_recycler_item<span class="token punctuation">,</span> viewGroup<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MyViewHodler</span> viewHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyViewHodler</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> viewHolder<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">MyViewHodler</span> viewHolder<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 传入的位置，找到对应的model，绑定到ViewHolder上</span>
    <span class="token class-name">TextView</span> textView <span class="token operator">=</span> viewHolder<span class="token punctuation">.</span>textView<span class="token punctuation">;</span>
    <span class="token class-name">String</span> text <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    textView<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="八、其他"><a href="#八、其他" class="header-anchor">#</a> 八、其他</h1> <h2 id="_1-getstring-的使用"><a href="#_1-getstring-的使用" class="header-anchor">#</a> 1 getString 的使用</h2> <p>在 android 代码里，经常需要用到多语言。通常的解决方案都是用 xml 声明好对应的字符串，然后在代码里面引用这个字符串对应的 id 即可。</p> <p>举个例子</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>hello %s<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>假设需要把%s 换成用户的名字，在代码里怎么写呢？</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> formatStr <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>test<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对于多个参数的情况, 需要加序号，例如：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>string_withdraw_tips1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>提示：最小提现数量%1$s %2$s , 24小时最大提现数量: %3$s %4$s<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>其中 <code>1$</code> , <code>2$</code> 表明了插入顺序，getString() 方法中填入的参数 第一个插入到 <code>1$</code> 的位置，第二个插入到 <code>2$</code> 的位置。</p> <p>使用实例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>string_withdraw_tips1<span class="token punctuation">,</span> <span class="token string">&quot;0.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;BTC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;BTC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;getString&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 11253-11253/com.koda.demo D/getString: 提示：最小提现数量0.1 BTC , 24小时最大提现数量: 20 BTC</span>
</code></pre></div><p>如果我们写反了顺序，比如：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;string name=&quot;string_withdraw_tips1&quot;&gt;提示：最小提现数量%1$s %2$s , 24小时最大提现数量: %4$s %3$s&lt;/string&gt;
</code></pre></div><p>那么对应的传参也要换一个顺序：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>string_withdraw_tips2<span class="token punctuation">,</span> <span class="token string">&quot;0.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;BTC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;BTC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;30&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;test_string&quot;</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 11253-11253/com.koda.demo D/getString: 提示：最小提现数量0.1 BTC , 24小时最大提现数量: 30 BTC</span>


</code></pre></div><p>其他的，假如说需要加空格、或者 0，或者小数的话，就要用到下面的格式了。</p> <p><strong>格式说明</strong>：</p> <p>%n$ms：代表输出的是字符串，n 代表是第几个参数，设置 m 的值可以在输出之前放置空格</p> <p>%n$md：代表输出的是整数，n 代表是第几个参数，设置 m 的值可以在输出之前放置空格，也可以设为 0m,在输出之前放置 m 个 0</p> <p>%n$mf：代表输出的是浮点数，n 代表是第几个参数，设置 m 的值可以控制小数位数，如 m=2.2 时，输出格式为 00.00</p> <h3 id="-3"><a href="#-3" class="header-anchor">#</a></h3> <h2 id="_2-多线程使用"><a href="#_2-多线程使用" class="header-anchor">#</a> 2 多线程使用</h2> <blockquote><p>4 种多线程使用方式，4 种场景</p> <p>https://www.jianshu.com/p/5225824ec967</p></blockquote> <h3 id="方式-1：handler-thread"><a href="#方式-1：handler-thread" class="header-anchor">#</a> 方式 1：Handler + Thread</h3> <blockquote><h4 id="使用介绍："><a href="#使用介绍：" class="header-anchor">#</a> 使用介绍：</h4></blockquote> <p>1.在主线程创建 handler 实例对象；</p> <p>2.通过 handler 的<code>send message</code> 方法或<code>post runnable</code>方法;</p> <ol start="3"><li></li></ol> <p>工作原理如下：</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-10-12-060238.jpg" alt="2839011-7036df5ffea97ec2"></p> <p>handler 会把 message 或者 runnable 对象传递到消息队列中。</p> <p>UI 主线程获取到 Runnable 或者 message 时，会去运行 runnable 的 run 方法，或者处理消息；</p> <blockquote><p><strong>post runnable</strong></p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 首先创建在主线程里创建一个Handler，它会自动绑定到MainThread中</span>
<span class="token keyword">private</span> <span class="token class-name">Handler</span> handler<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通过handler来处理业务：我这里的处理逻辑是，当点击按钮时，通过handler post一个runnable，然后去修改主线程的UI</span>
<span class="token keyword">class</span> <span class="token class-name">MyClickListener</span> <span class="token keyword">implements</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main thread id &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token class-name">Drawable</span> drawable <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDrawable</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_launcher_background<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              imageView<span class="token punctuation">.</span><span class="token function">setImageDrawable</span><span class="token punctuation">(</span>drawable<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sub thread id &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          handler<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>打印结果：</p> <div class="language-verilog extra-class"><pre class="language-verilog"><code><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">26.469</span> <span class="token number">10849</span><span class="token operator">-</span><span class="token number">10849</span><span class="token operator">/</span>com<span class="token punctuation">.</span>koda<span class="token punctuation">.</span>demo I<span class="token operator">/</span>System<span class="token punctuation">.</span>out<span class="token punctuation">:</span> main thread id <span class="token number">2</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">26.479</span> <span class="token number">10849</span><span class="token operator">-</span><span class="token number">10849</span><span class="token operator">/</span>com<span class="token punctuation">.</span>koda<span class="token punctuation">.</span>demo I<span class="token operator">/</span>System<span class="token punctuation">.</span>out<span class="token punctuation">:</span> sub thread id <span class="token number">2</span>
</code></pre></div><p>两个线程其实就是同一个线程，说明 handler post 线程最后是交给主线程处理的；</p> <blockquote><p><strong>send message</strong></p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 声明handler，并且重写handleMessage方法</span>
<span class="token keyword">private</span> <span class="token class-name">Handler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;handler thread : &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 会接收到msg消息；</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>what <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Drawable</span> drawable <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDrawable</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_launcher_foreground<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                imageView<span class="token punctuation">.</span><span class="token function">setImageDrawable</span><span class="token punctuation">(</span>drawable<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 向handler发送message</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// System.out.println(&quot;send thread : &quot; + Thread.currentThread().getName());</span>
      <span class="token comment">// 模拟处理事件，然后异步通知handler</span>
      <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    message<span class="token punctuation">.</span>what <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    message<span class="token punctuation">.</span>arg1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    handler<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>主线程会接收到消息，然后进行处理</p> <div class="language-verilog extra-class"><pre class="language-verilog"><code><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">09</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">43.761</span> <span class="token number">21083</span><span class="token operator">-</span><span class="token number">21135</span><span class="token operator">/</span>com<span class="token punctuation">.</span>koda<span class="token punctuation">.</span>demo I<span class="token operator">/</span>System<span class="token punctuation">.</span>out<span class="token punctuation">:</span> send thread <span class="token punctuation">:</span> Thread<span class="token operator">-</span><span class="token number">4</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">09</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">43.762</span> <span class="token number">21083</span><span class="token operator">-</span><span class="token number">21083</span><span class="token operator">/</span>com<span class="token punctuation">.</span>koda<span class="token punctuation">.</span>demo I<span class="token operator">/</span>System<span class="token punctuation">.</span>out<span class="token punctuation">:</span> handler thread <span class="token punctuation">:</span> main
</code></pre></div><blockquote><h4 id="使用注意："><a href="#使用注意：" class="header-anchor">#</a> 使用注意：</h4></blockquote> <p><strong>1.内存泄露</strong>：</p> <p>上面的例子里<code>Handler handler = new Handler() {...}</code>声明的是一个匿名内部类；</p> <p>而 java 里<code>非静态内部类</code>和<code>匿名内部类</code>都会默认持有外部类的引用。所以这里 handler 持有了 Activity 实例的引用。</p> <p>当 Activity 发生重绘（旋转设备或者意外）而导致销毁时，如果 handler 的消息队列里还有没处理好的消息，那么消息实例仍会持有 handler 的引用，而 handler 引用了 Activity 的实例，所以最终导致 Activity 内存无法被回收，但是又有新的 Activity 创建。</p> <p>最终导致泄露；</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-10-13-025150.png" alt="944365-fb0840209b472094"></p> <p>==解决方案==：静态内部类 + 弱引用</p> <p>因为 java 中静态内部类不默认持有外部类的引用。所以 handler 实例不会引用 Activity 实例；同时，如果加上<strong>使用 WeakReference 弱引用 Activity</strong>，GC 在进行垃圾回收时，就会忽略 handler，回收 Activity 的内存。</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">// 设置为：静态内部类</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FHandler</span> <span class="token keyword">extends</span> <span class="token class-name">Handler</span><span class="token punctuation">{</span>
        <span class="token comment">// 定义 弱引用实例</span>
        <span class="token keyword">private</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Activity</span><span class="token punctuation">&gt;</span></span> reference<span class="token punctuation">;</span>

        <span class="token comment">// 在构造方法中传入需持有的Activity实例</span>
        <span class="token keyword">public</span> <span class="token class-name">FHandler</span><span class="token punctuation">(</span><span class="token class-name">Activity</span> activity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 使用WeakReference弱引用持有Activity实例</span>
            reference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Activity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>activity<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">// 通过复写handlerMessage() 从而确定更新UI的操作</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>what<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;收到线程1的消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot; 收到线程2的消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>参考文章：https://www.jianshu.com/p/ed9e15eff47a</p> <blockquote><h4 id="定时任务："><a href="#定时任务：" class="header-anchor">#</a> 定时任务：</h4></blockquote> <p>另一个要注意的点是：</p> <p>handler 可以 postDelay 来做延迟执行。但是<strong>不要用这个方法</strong>做循环的定时任务；因为 postDelay 的任务最终也是交给主线程去完成的；</p> <blockquote><h5 id="适用场景："><a href="#适用场景：" class="header-anchor">#</a> 适用场景：</h5></blockquote> <p>在多个异步任务的更新 UI</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-10-13-024411.png" alt="utf-8' '944365-4a64038632c4c88f"></p> <p><strong>缺点</strong>: 编写代码复杂，创建和销毁线程其实是需要消耗资源的；</p> <blockquote><h4 id="api"><a href="#api" class="header-anchor">#</a> API</h4></blockquote> <p>removeMessage 可以移除任务队列里面的消息</p> <hr> <h3 id="方式-2：asynctask"><a href="#方式-2：asynctask" class="header-anchor">#</a> 方式 2：AsyncTask</h3> <blockquote><h4 id="作用"><a href="#作用" class="header-anchor">#</a> 作用:</h4></blockquote> <ol><li><h4 id="实现多线程"><a href="#实现多线程" class="header-anchor">#</a> 实现多线程</h4> <p>在工作线程中执行任务，如 耗时任务；</p></li> <li><h4 id="异步通信、消息传递"><a href="#异步通信、消息传递" class="header-anchor">#</a> 异步通信、消息传递</h4> <p><strong>实现工作线程 &amp; 主线程（UI 线程）之间的通信</strong>，即：将工作线程的执行结果传递给主线程，从而在主线程中执行相关的<code>UI</code>操作；</p></li></ol> <blockquote><h4 id="使用："><a href="#使用：" class="header-anchor">#</a> 使用：</h4></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AsyncTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Params</span><span class="token punctuation">,</span> <span class="token class-name">Progress</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre></div><p>AsyncTask 类中参数为 3 种泛型类型，控制 AsyncTask 子类执行线程任务时各个阶段的返回类型</p> <p>a. Params：开始异步任务执行时传入的参数类型</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-10-12-100005.png" alt="image-20191012175944886"></p> <p>b.Progress：异步任务执行过程中，返回进度值的类型。类型和 onProgressUpdate()方法的入参数一致</p> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-10-12-100528.png" alt="image-20191012180527997"></p> <p>c. Result：异步任务执行完成后，返回的结果类型，与 doInBackground()的返回值类型保持一致</p> <blockquote><h4 id="使用注意：-2"><a href="#使用注意：-2" class="header-anchor">#</a> 使用注意：</h4></blockquote> <h3 id="方式-3：handlerthread"><a href="#方式-3：handlerthread" class="header-anchor">#</a> 方式 3：HandlerThread</h3> <blockquote><h4 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h4></blockquote> <p>先总结一下<code>Handler</code>异步通信机制中的相关概念</p> <table><thead><tr><th>概念</th> <th>定义</th> <th>作用</th> <th>备注</th></tr></thead> <tbody><tr><td>主线程</td> <td>当 app 启动时，会自动开启一个主线程</td> <td>用来渲染 UI，处理事件</td> <td></td></tr> <tr><td>子线程</td> <td>一般是手动的开启线程</td> <td>执行耗时操作（比如网络请求）</td> <td></td></tr> <tr><td>消息 Message</td> <td>作为在线程间进行通信的媒介</td> <td>用来定义传递的消息</td> <td></td></tr> <tr><td>消息队列 MessageQueue</td> <td></td> <td>用来存储 handler 发送的消息</td> <td></td></tr> <tr><td>消息处理器 Handler</td> <td>主线程与子线程的通信<br>线程消息的主要处理者</td> <td>发送消息到 message queue<br>处理 looper 发送过来的消息</td> <td></td></tr> <tr><td>循环器 Looper</td> <td>消息队列与处理者的媒介</td> <td>不断的从消息队列中获取消息<br>将消息发送给对应处理的 handler</td> <td>每个线程中只能有 1 个 looper<br>1 个 looper 可以绑定多个线程的 handler</td></tr></tbody></table> <p>HandlerThread 的本质是：继承<code>Thread</code>类 &amp; 封装<code>Handler</code>类</p> <blockquote><h4 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h4></blockquote> <p>HandlerThread 的使用步骤分为 5 步</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerLearnActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Handler</span> handler<span class="token punctuation">,</span> mainHandler<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">HandlerThread</span> handlerThread<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Button</span> button1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Button</span> button2<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Button</span> button3<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">TextView</span> textView<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_handler_learn<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Main Thread : &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mainHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 步骤1：创建HandlerThread实例对象</span>
        <span class="token comment">// 传入参数 = 线程名字，作用 = 标记该线程</span>
        handlerThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HandlerThread</span><span class="token punctuation">(</span><span class="token string">&quot;HandlerLearnActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 步骤2：启动线程</span>
        handlerThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      	<span class="token comment">// 步骤3：声明worker handler</span>
      	<span class="token comment">// 作用：关联HandlerThread的Looper对象、实现消息处理操作 &amp; 与Main线程进行通信</span>
        handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span>handlerThread<span class="token punctuation">.</span><span class="token function">getLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>what <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 当前执行线程 = mHandlerThread所创建的工作线程</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Work Thread : &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                  	<span class="token comment">// 通过主线程Handler.post方法进行在主线程的UI更新操作</span>
                    mainHandler<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Main Thread : &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        textView<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">&quot;我爱学习&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token comment">//步骤4：使用工作线程Handler向工作线程的消息队列发送消息</span>
 <span class="token comment">//在工作线程中，当消息循环时,取出对应消息 &amp; 在工作线程执行相关操作</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        button1<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                message<span class="token punctuation">.</span>what <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                handler<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        button2<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                message<span class="token punctuation">.</span>what <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
                handler<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="方式-4：intentservice"><a href="#方式-4：intentservice" class="header-anchor">#</a> 方式 4：IntentService</h3> <blockquote><h4 id="作用-2"><a href="#作用-2" class="header-anchor">#</a> 作用</h4></blockquote> <p>创建 1 个工作子线程来处理多线程任务；</p> <blockquote><h4 id="使用步骤"><a href="#使用步骤" class="header-anchor">#</a> 使用步骤</h4></blockquote> <p>步骤 1：定义 <code>IntentService</code>的子类，需复写<code>onHandleIntent()</code>方法
步骤 2：在<code>Manifest.xml</code>中注册服务
步骤 3：在<code>Activity</code>中开启<code>Service</code>服务</p> <blockquote><h4 id="实例"><a href="#实例" class="header-anchor">#</a> 实例</h4></blockquote> <ol><li><p>定义子类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyIntentService</span> <span class="token keyword">extends</span> <span class="token class-name">IntentService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理耗时任务；</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onHandleIntent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> taskName <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;taskName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>taskName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&quot;task1&quot;</span><span class="token operator">:</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;myIntentService&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;do task1 start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        i<span class="token operator">++</span><span class="token punctuation">;</span>
                        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;myIntentService&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;等待&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot; s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;myIntentService&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;do task1 finished&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">&quot;task2&quot;</span><span class="token operator">:</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;myIntentService&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;do task2 finished&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MyIntentService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;MyIntentService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;myIntentService created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">,</span> <span class="token keyword">int</span> startId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;myIntentService start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> startId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 默认将intent放入任务队列</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">onStartCommand</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">int</span> startId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;myIntentService start command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStartCommand</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> startId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;myIntentService start destroy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <ol start="2"><li><p>在 Manifest.xml 中注册服务</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>.views.thread_message.MyIntentService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 通过action来过滤intent --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.example.koda.intent_service<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>在 Activity 中开启 Service 服务</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_intent_service_learn<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Intent</span> intent1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.koda.intent_service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      	<span class="token comment">// 设置IntentService所在应用的app包名；</span>
        intent1<span class="token punctuation">.</span><span class="token function">setPackage</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.koda.imagewrapper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent1<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;taskName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;task1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">startService</span><span class="token punctuation">(</span>intent1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Intent</span> intent2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.koda.intent_service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent2<span class="token punctuation">.</span><span class="token function">setPackage</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.koda.imagewrapper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent2<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;taskName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;task2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">startService</span><span class="token punctuation">(</span>intent2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol> <p>运行日志：</p> <div class="language-verilog extra-class"><pre class="language-verilog"><code><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">01.047</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22134</span><span class="token operator">/</span> D<span class="token operator">/</span>MyIntentService<span class="token punctuation">.</span>java<span class="token punctuation">:</span> <span class="token punctuation">[</span>onCreate<span class="token punctuation">:</span><span class="token number">43</span><span class="token punctuation">]</span>myIntentService created
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">01.049</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22134</span><span class="token operator">/</span> D<span class="token operator">/</span>MyIntentService<span class="token punctuation">.</span>java<span class="token punctuation">:</span> <span class="token punctuation">[</span>onStartCommand<span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">]</span>myIntentService start command
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">01.050</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22134</span><span class="token operator">/</span> D<span class="token operator">/</span>MyIntentService<span class="token punctuation">.</span>java<span class="token punctuation">:</span> <span class="token punctuation">[</span>onStart<span class="token punctuation">:</span><span class="token number">49</span><span class="token punctuation">]</span>myIntentService start
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">01.051</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22500</span><span class="token operator">/</span> I<span class="token operator">/</span>myIntentService<span class="token punctuation">:</span> <span class="token keyword">do</span> task1 start
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">01.052</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22134</span><span class="token operator">/</span> D<span class="token operator">/</span>MyIntentService<span class="token punctuation">.</span>java<span class="token punctuation">:</span> <span class="token punctuation">[</span>onStartCommand<span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">]</span>myIntentService start command
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">01.052</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22134</span><span class="token operator">/</span> D<span class="token operator">/</span>MyIntentService<span class="token punctuation">.</span>java<span class="token punctuation">:</span> <span class="token punctuation">[</span>onStart<span class="token punctuation">:</span><span class="token number">49</span><span class="token punctuation">]</span>myIntentService start
  <span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">25.379</span> <span class="token number">22746</span><span class="token operator">-</span><span class="token number">22795</span><span class="token operator">/</span> I<span class="token operator">/</span>myIntentService<span class="token punctuation">:</span> 等待<span class="token number">1</span> s
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">26.380</span> <span class="token number">22746</span><span class="token operator">-</span><span class="token number">22795</span><span class="token operator">/</span> I<span class="token operator">/</span>myIntentService<span class="token punctuation">:</span> 等待<span class="token number">2</span> s
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">27.381</span> <span class="token number">22746</span><span class="token operator">-</span><span class="token number">22795</span><span class="token operator">/</span> I<span class="token operator">/</span>myIntentService<span class="token punctuation">:</span> 等待<span class="token number">3</span> s
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">28.384</span> <span class="token number">22746</span><span class="token operator">-</span><span class="token number">22795</span><span class="token operator">/</span> I<span class="token operator">/</span>myIntentService<span class="token punctuation">:</span> 等待<span class="token number">4</span> s
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">29.385</span> <span class="token number">22746</span><span class="token operator">-</span><span class="token number">22795</span><span class="token operator">/</span> I<span class="token operator">/</span>myIntentService<span class="token punctuation">:</span> 等待<span class="token number">5</span> s
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">06.052</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22500</span><span class="token operator">/</span> I<span class="token operator">/</span>myIntentService<span class="token punctuation">:</span> <span class="token keyword">do</span> task1 finished
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">06.056</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22500</span><span class="token operator">/</span> I<span class="token operator">/</span>myIntentService<span class="token punctuation">:</span> <span class="token keyword">do</span> task2 finished
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">06.060</span> <span class="token number">22134</span><span class="token operator">-</span><span class="token number">22134</span><span class="token operator">/</span> D<span class="token operator">/</span>MyIntentService<span class="token punctuation">.</span>java<span class="token punctuation">:</span> <span class="token punctuation">[</span>onDestroy<span class="token punctuation">:</span><span class="token number">62</span><span class="token punctuation">]</span>myIntentService start destroy
</code></pre></div><p>从上面的日志看出来，task1 和 task2 是按顺序执行的；因为所有的任务都在同一个<code>Thread looper</code>里执行，所以必须 task1 完成才会执行 task2；</p> <h2 id="_3-系统语言获取"><a href="#_3-系统语言获取" class="header-anchor">#</a> 3 系统语言获取</h2> <p>Android 系统的当前系统语言，可以通过 Locale 类获取，主要方法有 3 种：</p> <p>1.Locale.getDefault().getLanguage()，返回的是 es 或者 zh；</p> <p>2.Locale.getDefault().getCountry()，获取当前国家或地区，返回为 CN 或 US；</p> <p>3.还有另外一种获取当前语言的方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Localelocale</span> <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>locale<span class="token punctuation">;</span>

<span class="token class-name">String</span> language <span class="token operator">=</span>locale<span class="token punctuation">.</span><span class="token function">getLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> language<span class="token punctuation">;</span>
</code></pre></div><p>如果当前手机设置为中文- 中国，则使用此方法返回 zh-CN，同理可得到其他语言与地区的信息。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token operator">--</span><span class="token operator">-&gt;</span> en
<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getISO3Language</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token operator">--</span><span class="token operator">-&gt;</span> eng
<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token operator">--</span><span class="token operator">-&gt;</span> US
<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getISO3Country</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token operator">--</span><span class="token operator">-&gt;</span> USA
<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">-&gt;</span> <span class="token class-name">United</span> <span class="token class-name">States</span>
<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token operator">--</span><span class="token operator">-&gt;</span> <span class="token class-name">English</span> <span class="token punctuation">(</span><span class="token class-name">United</span> <span class="token class-name">States</span><span class="token punctuation">)</span>
<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token operator">--</span><span class="token operator">-&gt;</span> en_US
<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">-&gt;</span> <span class="token class-name">English</span>
<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLanguageTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token operator">--</span><span class="token operator">-&gt;</span> en<span class="token operator">-</span>US

</code></pre></div><h2 id="_4-组件传值"><a href="#_4-组件传值" class="header-anchor">#</a> 4 组件传值</h2> <h3 id="事件传递"><a href="#事件传递" class="header-anchor">#</a> 事件传递</h3> <ul><li><h3 id="bus"><a href="#bus" class="header-anchor">#</a> Bus</h3> <blockquote><p>文档链接：<a href="http://square.github.io/otto/" target="_blank" rel="noopener noreferrer">http://square.github.io/otto/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote></li> <li><h3 id="eventbus"><a href="#eventbus" class="header-anchor">#</a> EventBus</h3> <p>EventBus 原理：通过事件类型，来进行订阅发布</p> <img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-08-12-070412.png" alt="image-20190812150412158" style="zoom:50%;"></li></ul> <p>// todo 待补充</p> <ul><li><p>文档链接：<a href="http://greenrobot.org/eventbus/documentation/delivery-threads-threadmode/" target="_blank" rel="noopener noreferrer">http://greenrobot.org/eventbus/documentation/delivery-threads-threadmode/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>事件处理模式</p> <ol><li>ThreadMode.POSTING:</li></ol> <p>订阅者被调用的线程和提交事件的线程是同一个线程，</p> <p>这个模式下，开销最小，因为它完全不需要切换线程；</p></li></ul> <ol start="2"><li><p>ThreadMode.MAIN：在主线程中处理。一般会涉及到 UI 的处理。</p></li> <li><p>ThreadMode.MAIN_ORDERED： 在主线程中处理，并且严格按照提交的顺序，并保持一致。</p></li> <li><p>ThreadMode.BACKGROUND：</p></li> <li><p>ThreadMode.ASYNC：</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Called in the same thread (default)</span>
<span class="token comment">// ThreadMode is optional here</span>
<span class="token annotation punctuation">@Subscribe</span><span class="token punctuation">(</span>threadMode <span class="token operator">=</span> <span class="token class-name">ThreadMode</span><span class="token punctuation">.</span>POSTING<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">MessageEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="intent-传值"><a href="#intent-传值" class="header-anchor">#</a> Intent 传值</h3> <h1 id="九、数据存储"><a href="#九、数据存储" class="header-anchor">#</a> 九、数据存储</h1> <p>文件存储的 5 种方式：</p> <p>1.SharedPreferences</p> <p>2.文件存储</p> <p>3.ContentProvider</p> <p>4.SQLite</p> <p>5.网络存储</p> <h2 id="文件存储"><a href="#文件存储" class="header-anchor">#</a> 文件存储</h2> <p>安卓文件存储分为内部存储和外部存储两大块；</p> <h3 id="内部存储"><a href="#内部存储" class="header-anchor">#</a> 内部存储</h3> <p>app 有一个自己专用的存储目录：<code>/data/data/${PackageName}</code>.这个目录里存放了 WebView 缓存页面信息，SharedPreferences 和 数据库数据等信息。</p> <img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-09-14-022102.png" width="400"> <p>系统会自动在 package 的目录里面创建几个子目录, 通过 context 的方法来获取</p> <img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2019-09-14-024334.png"> <ul><li><code>File getFilesDir()</code>：返回内部存储的 Files 文件夹</li> <li><code>File getCacheDir()</code>：返回内部存储的 cache 文件夹</li> <li><code>File getCodeCacheDir()</code> ：返回内部存储的 code_cache 文件夹，要求 Android5.0+</li> <li><code>File getDataDir()</code> ： 返回内部存储的根文件夹，要求 Android7.0+</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 内部存储</span>
<span class="token class-name">String</span> fileStreamPath <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getFileStreamPath</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> filesDir <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getFilesDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> enviornmentDataDir <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getDataDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;file--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fileStreamPath: &quot;</span> <span class="token operator">+</span> fileStreamPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;file--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;filesDir: &quot;</span> <span class="token operator">+</span> filesDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DebugLog</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;file--&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;enviornmentDataDir: &quot;</span> <span class="token operator">+</span> enviornmentDataDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 文件写</span>
<span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openFileOutput</span><span class="token punctuation">(</span><span class="token string">&quot;hello.txt&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><blockquote><p>当用户卸载 App 时，系统自动删除 data/data/package 目录文件夹及其内容。</p></blockquote> <h3 id="外部存储"><a href="#外部存储" class="header-anchor">#</a> 外部存储</h3> <blockquote><p>内部存储文件都是私有的，但是因为空间有限，所以 Android 在外部存储空间中也提供了特殊的目录来存储私有文件。目录如下：</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>/storage/emulated/0/Android/data/${package}

extraFileDir: /storage/emulated/0/Android/data/com.example.koda.imagewrapper/files
externalCacheDir: /storage/emulated/0/Android/data/com.example.koda.imagewrapper/cache

</code></pre></div><p>除了一些私有目录之外，还有一些目录是公用的。比如说用户通过 APP 来保存的图片、下载的文件。这些内容一般不希望随着 APP 卸载而被清除，所以 Android 单独开辟了一个目录来存放。 开发者可以通过 Environment 类提供的方法<code>getExternalStoragePublicDirectory</code>直接获取相应目录的绝对路径。</p> <p>Android 默认创建了几个不同的类型目录，通过传递不同的 type 参数类型可以获取到目录：</p> <div class="language- extra-class"><pre class="language-text"><code> /storage/emulated/0/Music
 /storage/emulated/0/Download
</code></pre></div><h1 id="编码规范"><a href="#编码规范" class="header-anchor">#</a> <a href="./Android%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83">编码规范</a></h1></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.3bcc0bcc.js" defer></script><script src="/assets/js/2.c5c14eb8.js" defer></script><script src="/assets/js/50.69fff158.js" defer></script>
  </body>
</html>
