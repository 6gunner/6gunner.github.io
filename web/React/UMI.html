<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>UmiJS | Coda的博客</title>
    <meta name="generator" content="VuePress 1.5.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="闲着无聊？那就读书吧">
    <link rel="preload" href="/assets/css/0.styles.c3659042.css" as="style"><link rel="preload" href="/assets/js/app.ab75ed54.js" as="script"><link rel="preload" href="/assets/js/2.7c7b516a.js" as="script"><link rel="preload" href="/assets/js/49.37a0c336.js" as="script"><link rel="prefetch" href="/assets/js/10.27624e2e.js"><link rel="prefetch" href="/assets/js/100.c7488e59.js"><link rel="prefetch" href="/assets/js/101.21e1cfe3.js"><link rel="prefetch" href="/assets/js/102.82f628ea.js"><link rel="prefetch" href="/assets/js/103.b136c3a8.js"><link rel="prefetch" href="/assets/js/104.b2335111.js"><link rel="prefetch" href="/assets/js/105.f7f33196.js"><link rel="prefetch" href="/assets/js/106.33afd343.js"><link rel="prefetch" href="/assets/js/107.0c0ba6c6.js"><link rel="prefetch" href="/assets/js/108.e77b8489.js"><link rel="prefetch" href="/assets/js/109.5a80c9eb.js"><link rel="prefetch" href="/assets/js/11.0b45a4d2.js"><link rel="prefetch" href="/assets/js/110.4553f0ef.js"><link rel="prefetch" href="/assets/js/111.300c43c0.js"><link rel="prefetch" href="/assets/js/112.a7d89c35.js"><link rel="prefetch" href="/assets/js/113.171ab8f3.js"><link rel="prefetch" href="/assets/js/114.f58c358c.js"><link rel="prefetch" href="/assets/js/115.60c95b56.js"><link rel="prefetch" href="/assets/js/116.ef3bc3fd.js"><link rel="prefetch" href="/assets/js/117.40c2d400.js"><link rel="prefetch" href="/assets/js/118.d4e567f7.js"><link rel="prefetch" href="/assets/js/119.508b4b0d.js"><link rel="prefetch" href="/assets/js/12.92c6e45c.js"><link rel="prefetch" href="/assets/js/120.08d59e01.js"><link rel="prefetch" href="/assets/js/121.68121824.js"><link rel="prefetch" href="/assets/js/122.92162ee7.js"><link rel="prefetch" href="/assets/js/13.f01235bf.js"><link rel="prefetch" href="/assets/js/14.6f36b30a.js"><link rel="prefetch" href="/assets/js/15.6c792851.js"><link rel="prefetch" href="/assets/js/16.c610593a.js"><link rel="prefetch" href="/assets/js/17.d424583c.js"><link rel="prefetch" href="/assets/js/18.f2df71d6.js"><link rel="prefetch" href="/assets/js/19.5fc8cebd.js"><link rel="prefetch" href="/assets/js/20.8995b21e.js"><link rel="prefetch" href="/assets/js/21.86b9bfb1.js"><link rel="prefetch" href="/assets/js/22.a0f9800b.js"><link rel="prefetch" href="/assets/js/23.c600b58d.js"><link rel="prefetch" href="/assets/js/24.48ac403d.js"><link rel="prefetch" href="/assets/js/25.27aa9981.js"><link rel="prefetch" href="/assets/js/26.603bdaff.js"><link rel="prefetch" href="/assets/js/27.6f56182a.js"><link rel="prefetch" href="/assets/js/28.3305a0e9.js"><link rel="prefetch" href="/assets/js/29.5b741a1f.js"><link rel="prefetch" href="/assets/js/3.2a5c0790.js"><link rel="prefetch" href="/assets/js/30.b049a0bc.js"><link rel="prefetch" href="/assets/js/31.2777fef6.js"><link rel="prefetch" href="/assets/js/32.c6876688.js"><link rel="prefetch" href="/assets/js/33.5912b1cb.js"><link rel="prefetch" href="/assets/js/34.d88222ad.js"><link rel="prefetch" href="/assets/js/35.c0a73a14.js"><link rel="prefetch" href="/assets/js/36.00d0b5f6.js"><link rel="prefetch" href="/assets/js/37.621e3465.js"><link rel="prefetch" href="/assets/js/38.ce8a9a3d.js"><link rel="prefetch" href="/assets/js/39.367987fd.js"><link rel="prefetch" href="/assets/js/4.84f6746f.js"><link rel="prefetch" href="/assets/js/40.396176aa.js"><link rel="prefetch" href="/assets/js/41.c39f7b41.js"><link rel="prefetch" href="/assets/js/42.d39ba6fd.js"><link rel="prefetch" href="/assets/js/43.c553abd8.js"><link rel="prefetch" href="/assets/js/44.e1d01935.js"><link rel="prefetch" href="/assets/js/45.85eda8e6.js"><link rel="prefetch" href="/assets/js/46.5d171ed6.js"><link rel="prefetch" href="/assets/js/47.9f8d9eff.js"><link rel="prefetch" href="/assets/js/48.0b28deb0.js"><link rel="prefetch" href="/assets/js/5.5858b048.js"><link rel="prefetch" href="/assets/js/50.d050f9b1.js"><link rel="prefetch" href="/assets/js/51.3845482b.js"><link rel="prefetch" href="/assets/js/52.dc113850.js"><link rel="prefetch" href="/assets/js/53.b4035495.js"><link rel="prefetch" href="/assets/js/54.42ccfbed.js"><link rel="prefetch" href="/assets/js/55.5f7dbe20.js"><link rel="prefetch" href="/assets/js/56.d4791533.js"><link rel="prefetch" href="/assets/js/57.96e328e6.js"><link rel="prefetch" href="/assets/js/58.02080a48.js"><link rel="prefetch" href="/assets/js/59.7a4597c0.js"><link rel="prefetch" href="/assets/js/6.f73da795.js"><link rel="prefetch" href="/assets/js/60.9393a4a6.js"><link rel="prefetch" href="/assets/js/61.5a6ab329.js"><link rel="prefetch" href="/assets/js/62.d6412e9e.js"><link rel="prefetch" href="/assets/js/63.b5a7f34a.js"><link rel="prefetch" href="/assets/js/64.c9cddcd7.js"><link rel="prefetch" href="/assets/js/65.ad0c82f1.js"><link rel="prefetch" href="/assets/js/66.28cb91ad.js"><link rel="prefetch" href="/assets/js/67.66f91193.js"><link rel="prefetch" href="/assets/js/68.47cacb29.js"><link rel="prefetch" href="/assets/js/69.12c0d723.js"><link rel="prefetch" href="/assets/js/7.1751b963.js"><link rel="prefetch" href="/assets/js/70.ad0e27cf.js"><link rel="prefetch" href="/assets/js/71.394f01dc.js"><link rel="prefetch" href="/assets/js/72.3066f882.js"><link rel="prefetch" href="/assets/js/73.92298092.js"><link rel="prefetch" href="/assets/js/74.08fe9c75.js"><link rel="prefetch" href="/assets/js/75.1bb7461b.js"><link rel="prefetch" href="/assets/js/76.3368f834.js"><link rel="prefetch" href="/assets/js/77.e22703eb.js"><link rel="prefetch" href="/assets/js/78.5b3d1387.js"><link rel="prefetch" href="/assets/js/79.ffc3b486.js"><link rel="prefetch" href="/assets/js/8.33554b33.js"><link rel="prefetch" href="/assets/js/80.fce952ae.js"><link rel="prefetch" href="/assets/js/81.95d2b0e1.js"><link rel="prefetch" href="/assets/js/82.67a901f7.js"><link rel="prefetch" href="/assets/js/83.5b344c15.js"><link rel="prefetch" href="/assets/js/84.d8e80971.js"><link rel="prefetch" href="/assets/js/85.ca443067.js"><link rel="prefetch" href="/assets/js/86.47cb11f1.js"><link rel="prefetch" href="/assets/js/87.8ec3d92c.js"><link rel="prefetch" href="/assets/js/88.69df527b.js"><link rel="prefetch" href="/assets/js/89.8366e9e2.js"><link rel="prefetch" href="/assets/js/9.6fcb03a3.js"><link rel="prefetch" href="/assets/js/90.d2173910.js"><link rel="prefetch" href="/assets/js/91.bd7a3846.js"><link rel="prefetch" href="/assets/js/92.749da7f0.js"><link rel="prefetch" href="/assets/js/93.c95cc763.js"><link rel="prefetch" href="/assets/js/94.88f60507.js"><link rel="prefetch" href="/assets/js/95.149f6f91.js"><link rel="prefetch" href="/assets/js/96.8805afd4.js"><link rel="prefetch" href="/assets/js/97.db0e9b92.js"><link rel="prefetch" href="/assets/js/98.ca169aa3.js"><link rel="prefetch" href="/assets/js/99.3637ec5b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c3659042.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Coda的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/服务端/" class="nav-link">
  服务端
</a></div><div class="nav-item"><a href="/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/android/" class="nav-link">
  android
</a></div><div class="nav-item"><a href="/DevOps/" class="nav-link">
  devOps
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/服务端/" class="nav-link">
  服务端
</a></div><div class="nav-item"><a href="/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/android/" class="nav-link">
  android
</a></div><div class="nav-item"><a href="/DevOps/" class="nav-link">
  devOps
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>UmiJS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/React/UMI.html#umijs的背后思想" class="sidebar-link">UmiJS的背后思想</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/web/React/UMI.html#快速入门" class="sidebar-link">快速入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/UMI.html#利用cli来搭建项目" class="sidebar-link">利用cli来搭建项目</a></li><li class="sidebar-sub-header"><a href="/web/React/UMI.html#打包后的本地验证" class="sidebar-link">打包后的本地验证</a></li><li class="sidebar-sub-header"><a href="/web/React/UMI.html#部署" class="sidebar-link">部署</a></li></ul></li><li><a href="/web/React/UMI.html#目录说明" class="sidebar-link">目录说明</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/web/React/UMI.html#配置" class="sidebar-link">配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/UMI.html#多环境多份配置" class="sidebar-link">多环境多份配置</a></li></ul></li><li><a href="/web/React/UMI.html#约定式路由" class="sidebar-link">约定式路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/UMI.html#动态路由" class="sidebar-link">动态路由</a></li><li class="sidebar-sub-header"><a href="/web/React/UMI.html#可选的动态路由" class="sidebar-link">可选的动态路由</a></li><li class="sidebar-sub-header"><a href="/web/React/UMI.html#嵌套路由" class="sidebar-link">嵌套路由</a></li></ul></li><li><a href="/web/React/UMI.html#配置路由" class="sidebar-link">配置路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/UMI.html#component" class="sidebar-link">component</a></li><li class="sidebar-sub-header"><a href="/web/React/UMI.html#routes" class="sidebar-link">routes</a></li><li class="sidebar-sub-header"><a href="/web/React/UMI.html#路由权限配置" class="sidebar-link">路由权限配置</a></li></ul></li><li><a href="/web/React/UMI.html#插件" class="sidebar-link">插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/UMI.html#插件的作用" class="sidebar-link">插件的作用</a></li><li class="sidebar-sub-header"><a href="/web/React/UMI.html#插件的使用" class="sidebar-link">插件的使用</a></li></ul></li><li><a href="/web/React/UMI.html#环境变量" class="sidebar-link">环境变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/UMI.html#在-env-文件中定义" class="sidebar-link">在 .env 文件中定义</a></li></ul></li><li><a href="/web/React/UMI.html#命令行工具" class="sidebar-link">命令行工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/UMI.html#查看一下webpack的相关配置" class="sidebar-link">查看一下webpack的相关配置</a></li><li class="sidebar-sub-header"><a href="/web/React/UMI.html#调试umi" class="sidebar-link">调试umi</a></li></ul></li><li><a href="/web/React/UMI.html#preset-和-plugin-的区别" class="sidebar-link">preset 和 plugin 的区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/web/React/UMI.html#roadhog的配置" class="sidebar-link">roadhog的配置</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="umijs"><a href="#umijs" class="header-anchor">#</a> UmiJS</h1> <p>Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后==配以生命周期完善的插件体系==，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。</p> <h2 id="umijs的背后思想"><a href="#umijs的背后思想" class="header-anchor">#</a> UmiJS的背后思想</h2> <p><img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-11-25-000425.png" alt="img"></p> <p>如上图所示，umi将很多插件集合到了一起。然后收敛起来，让开发者只需要用Umi就可以实现开发。</p> <p><strong>插件收敛思想</strong></p> <img src="https://ipic-coda.oss-cn-beijing.aliyuncs.com/2020-11-25-000628.png" alt="img" style="zoom:33%;"> <h2 id="快速入门"><a href="#快速入门" class="header-anchor">#</a> 快速入门</h2> <h3 id="利用cli来搭建项目"><a href="#利用cli来搭建项目" class="header-anchor">#</a> 利用cli来搭建项目</h3> <div class="language- extra-class"><pre class="language-text"><code>➜  private mkdir umi-learn
➜  private cd umi-learn
➜  umi-learn yarn create @umijs/umi-app
</code></pre></div><h3 id="打包后的本地验证"><a href="#打包后的本地验证" class="header-anchor">#</a> 打包后的本地验证</h3> <p>发布之前，可以通过 <code>serve</code> 做本地验证，</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">yarn</span> global <span class="token function">add</span> serve
$ serve ./dist

Serving<span class="token operator">!</span>

- Local:            http://localhost:5000
- On Your Network:  http://<span class="token punctuation">{</span>Your IP<span class="token punctuation">}</span>:5000

Copied <span class="token builtin class-name">local</span> address to clipboard<span class="token operator">!</span>
</code></pre></div><p>访问 http://localhost:5000，正常情况下应该是和 <code>umi dev</code> 一致的。</p> <h3 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h3> <p>本地验证完，就可以部署了，这里通过 <a href="http://now.sh/" target="_blank" rel="noopener noreferrer">now<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来做演示。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> global <span class="token function">add</span> now
$ now ./dist

<span class="token operator">&gt;</span> Deploying /private/tmp/sorrycc-1KVCmK/dist under chencheng
<span class="token operator">&gt;</span> Synced <span class="token number">3</span> files <span class="token punctuation">(</span><span class="token number">301</span>.93KB<span class="token punctuation">)</span> <span class="token punctuation">[</span>2s<span class="token punctuation">]</span>
<span class="token operator">&gt;</span> https://dist-jtckzjjatx.now.sh <span class="token punctuation">[</span>in clipboard<span class="token punctuation">]</span> <span class="token punctuation">[</span>1s<span class="token punctuation">]</span>
<span class="token operator">&gt;</span> Deployment complete<span class="token operator">!</span>
</code></pre></div><p>通过now + zeit可以学会自动部署 https://zeit.co/account</p> <h2 id="目录说明"><a href="#目录说明" class="header-anchor">#</a> 目录说明</h2> <p>一个基础的 Umi 项目大致是这样的，</p> <div class="language- extra-class"><pre class="language-text"><code>.
├── package.json
├── .umirc.ts // 配置文件，包含 umi 内置功能和插件的配置。
├── .env // 环境变量
├── dist
├── mock
├── public
└── src
    ├── .umi
    ├── layouts/index.tsx
    ├── pages
        ├── index.less
        └── index.tsx
    └── app.ts // 运行时的配置项, 初始化项目里未看见，要手动创建
</code></pre></div><h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <h3 id="多环境多份配置"><a href="#多环境多份配置" class="header-anchor">#</a> 多环境多份配置</h3> <p>可以通过环境变量 <code>UMI_ENV</code> 区分不同环境来指定配置。</p> <p>举个例子，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .umirc.js 或者 config/config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// .umirc.cloud.js 或者 config/config.cloud.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> b<span class="token operator">:</span> <span class="token string">'cloud'</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token string">'cloud'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// .umirc.local.js 或者 config/config.local.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> c<span class="token operator">:</span> <span class="token string">'local'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>不指定 <code>UMI_ENV</code> 时，.umirc.js会自动和 .umirc.local.js进行一个deep merge，拿到的配置是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  c<span class="token operator">:</span> <span class="token string">'local'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>指定 <code>UMI_ENV=cloud</code> 时，拿到的配置是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token string">'cloud'</span><span class="token punctuation">,</span>
  c<span class="token operator">:</span> <span class="token string">'cloud'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="约定式路由"><a href="#约定式路由" class="header-anchor">#</a> 约定式路由</h2> <h3 id="动态路由"><a href="#动态路由" class="header-anchor">#</a> 动态路由</h3> <p>约定 <code>[]</code> 包裹的文件或文件夹为动态路由。</p> <p><s>v2约定<code>$</code>前缀的文件或文件夹为动态路由</s></p> <p>比如以下目录结构：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
  └── pages
    └── <span class="token punctuation">[</span>post<span class="token punctuation">]</span>
      ├── index.tsx
      └── comments.tsx
    └── <span class="token function">users</span>
      └── <span class="token punctuation">[</span>id<span class="token punctuation">]</span>.tsx
    └── index.tsx
</code></pre></div><p>会生成路由配置如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'./pages/index.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//约定$id文件名会创建一个:id的路由，代表一个变量</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/users/:id'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'./pages/users/$id.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// $post = :post;</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/:post/'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'./pages/$post/index.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/:post/comments'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'./pages/$post/comments.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="可选的动态路由"><a href="#可选的动态路由" class="header-anchor">#</a> 可选的动态路由</h3> <p>约定，带 <code>[ $]</code>包裹的文件或文件夹为动态可选路由。</p> <p><s>v2 里约定动态路由如果带 <code>$</code> 后缀，则为可选动态路由。</s></p> <p>比如以下结构：</p> <div class="language-text extra-class"><pre class="language-text"><code>+ pages/
  + users/
    - [id$].js
  - index.js
</code></pre></div><p>会生成路由配置如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> exact<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token operator">:</span> component<span class="token operator">:</span> <span class="token string">'./pages/index.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> exact<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/users/:id?'</span><span class="token operator">:</span> component<span class="token operator">:</span> <span class="token string">'./pages/users/[id$]'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="嵌套路由"><a href="#嵌套路由" class="header-anchor">#</a> 嵌套路由</h3> <p>Umi 里约定目录下有 <code>_layout.tsx</code> 时会生成嵌套路由，以 <code>_layout.tsx</code> 为该目录的 layout。</p> <p>layout 文件需要返回一个 React 组件，并通过 <code>props.children</code> 渲染子组件。</p> <p><code>_layout</code>主要用来实现一些组件的布局功能。</p> <p>比如以下目录结构，</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
└── pages
    └── <span class="token function">users</span>
        ├── _layout.tsx
        ├── index.tsx
        └── list.tsx
</code></pre></div><p>会生成路由，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> exact<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/users'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'@/pages/users/_layout'</span><span class="token punctuation">,</span>
    routes<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> exact<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/users'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'@/pages/users/index'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> exact<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/users/list'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'@/pages/users/list'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="配置路由"><a href="#配置路由" class="header-anchor">#</a> 配置路由</h2> <p>在<code>.umirc.(ts|js)</code> 或者 <code>config/config.(ts|js)</code> 文件中配置 <code>routes</code> 属性，<strong>此配置项存在时则不会对 <code>src/pages</code> 目录做约定式的解析</strong>。</p> <p>配置文档：https://umijs.org/zh/config/#routes</p> <h3 id="component"><a href="#component" class="header-anchor">#</a> component</h3> <ul><li>组件路径</li></ul> <p>可以是绝对路径，也可以是相对路径，如果是相对路径，会从 <code>src/pages</code> 开始找起。</p> <p>如果指向 <code>src</code> 目录的文件，可以用 <code>@</code>，也可以用 <code>../</code>。推荐用前者。</p> <div class="language-diff extra-class"><pre class="language-diff"><code>// component 指向的路由组件文件是从 src/pages 目录开始解析的
<span class="token unchanged">  routes: [
    {
      path: '/',
</span><span class="token inserted-sign inserted">+     exact: true,
</span><span class="token unchanged">      component: '../layouts/index',
      routes: [
        { path: '/', component: './index' },
      ],
    }, {
      path: '/users',
      component: '../layouts/index',
      routes: [
        { path: '/users', component: './users/index' },
        { path: '/users/:id', component: './users/$id' },
      ]
    }
  ],
</span></code></pre></div><h3 id="routes"><a href="#routes" class="header-anchor">#</a> routes</h3> <p>配置子路由，通常在需要为多个路径增加 layout 组件时使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/users'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'@/layouts/index'</span><span class="token punctuation">,</span>
      routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/users'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'./users/index'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/users/:id'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'./users/$id'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后在 <code>src/layouts/index</code> 中通过 <code>props.children</code> 渲染子路由，</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> padding<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> props<span class="token punctuation">.</span>children <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样，访问 <code>/users</code>和<code>/users/xx</code> 时就会带上 <code>src/layouts/index</code> 这个 layout 组件。</p> <h3 id="路由权限配置"><a href="#路由权限配置" class="header-anchor">#</a> 路由权限配置</h3> <p><strong><s>v2版本</s></strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>routes: [
...
<span class="token inserted-sign inserted">+ {
+	
+  	path: '/list',
+  	component: './list/index',
+  	// 渲染都会经过 ./routes/PrivateRoute.js，路径需要从src目录下配置目录
+  	Routes: ['./src/routes/PrivateRoute.js']  
+}
</span>...
]
</code></pre></div><p><strong>PrivateRoutes</strong>参考逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sessionStorage<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token function">PrivateRoute</span> <span class="token punctuation">(</span>routes<span class="token operator">/</span>PrivateRoute<span class="token punctuation">.</span>js<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span> props<span class="token punctuation">.</span>children <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token function">PrivateRoute</span> <span class="token punctuation">(</span>routes<span class="token operator">/</span>PrivateRoute<span class="token punctuation">.</span>js<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>v3版本</strong></p> <p>使用wrappers来配置一个高阶组件。</p> <div class="language- extra-class"><pre class="language-text"><code>export default {
  routes: [
    { path: '/user', component: 'user',
      wrappers: [
        '@/wrappers/auth',
      ],
    },
    { path: '/login', component: 'login' },
  ]
}
</code></pre></div><p>然后在 <code>src/wrappers/auth</code> 中，</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> isLogin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> props<span class="token punctuation">.</span>children <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样，访问 <code>/user</code>，就通过 <code>useAuth</code> 做权限校验。</p> <p>备注：v3版本的要比v2的好理解一些</p> <h2 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h2> <h3 id="插件的作用"><a href="#插件的作用" class="header-anchor">#</a> <strong>插件的作用</strong></h3> <p>umi以插件的形式，提供对外扩展的能力。</p> <p>通过插件，可以实现<code>修改打包配置</code>、<code>修改启动代码</code>、<code>修改HTML</code>等功能。</p> <h3 id="插件的使用"><a href="#插件的使用" class="header-anchor">#</a> 插件的使用</h3> <p>npm包里的<code>@umi/xxxx</code>依赖会自动声明为插件</p> <p>在配置里可通过 <code>presets</code> 和 <code>plugins</code> 配置插件，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./preset'</span><span class="token punctuation">,</span> <span class="token string">'foo/presets'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./plugin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><s>v2版本的插件说明</s></p> <p>https://v2.umijs.org/zh/plugin/umi-plugin-react.html#%E5%AE%89%E8%A3%85</p> <h2 id="环境变量"><a href="#环境变量" class="header-anchor">#</a> 环境变量</h2> <p>https://umijs.org/zh-CN/docs/env-variables#watch_ignored</p> <h3 id="在-env-文件中定义"><a href="#在-env-文件中定义" class="header-anchor">#</a> 在 .env 文件中定义</h3> <p>Umi 中约定根目录下的 <code>.env</code> 为环境变量配置文件。</p> <p>比如：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">3000</span>
<span class="token assign-left variable">BABEL_CACHE</span><span class="token operator">=</span>none
</code></pre></div><p>然后执行，</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ umi dev
</code></pre></div><p>会以 3000 端口启动 dev server，并且禁用 babel 的缓存。</p> <h2 id="命令行工具"><a href="#命令行工具" class="header-anchor">#</a> 命令行工具</h2> <h3 id="查看一下webpack的相关配置"><a href="#查看一下webpack的相关配置" class="header-anchor">#</a> 查看一下webpack的相关配置</h3> <h4 id="umi-webpack"><a href="#umi-webpack" class="header-anchor">#</a> <strong><code>umi webpack</code></strong></h4> <div class="language-js extra-class"><pre class="language-js"><code>$ umi webpack <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
参数，

可选参数	说明
rules	查看 webpack<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules 配置详情
rule<span class="token operator">=</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span>	查看 webpack<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules 中某个规则的配置详情
plugins	查看 webpack<span class="token punctuation">.</span>plugins 配置详情
plugin<span class="token operator">=</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span>	查看 webpack<span class="token punctuation">.</span>plugins 中某个插件的配置详情
示例，
</code></pre></div><h3 id="调试umi"><a href="#调试umi" class="header-anchor">#</a> 调试umi</h3> <p>Launch.json配置</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token comment">// Use IntelliSense to learn about possible attributes.</span>
    <span class="token comment">// Hover to view descriptions of existing attributes.</span>
    <span class="token comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Launch Program&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;skipFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;&lt;node_internals&gt;/**&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}/node_modules/umi/lib/cli.js&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dev&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;runtimeExecutable&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/Users/keyang/.nvm/versions/node/v12.13.0/bin/node&quot;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>eg: 比如我想去弄清楚umi里less的loader配置，就去找到代码打一个断点，然后用debug去执行<code>umi dev</code>命令。</p> <p>umi对css操作在<code>node_modules/@umijs/bundler-webpack/lib/getConfig/css.js</code>里</p> <p>然后打印了下webpack的配置</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">/* config.module.rule('css') */</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(css)(\?.*)?$/</span><span class="token punctuation">,</span>
        oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">/* config.module.rule('css').oneOf('css-modules') */</span>
          <span class="token punctuation">{</span>
            resourceQuery<span class="token operator">:</span> <span class="token regex">/modules/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token comment">/* config.module.rule('css').oneOf('css-modules').use('extract-css-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/mini-css-extract-plugin/dist/loader.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  publicPath<span class="token operator">:</span> <span class="token string">'./'</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('css').oneOf('css-modules').use('css-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/css-loader/dist/cjs.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  importLoaders<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  modules<span class="token operator">:</span> <span class="token punctuation">{</span>
                    localIdentName<span class="token operator">:</span> <span class="token string">'[local]___[hash:base64:5]'</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('css').oneOf('css-modules').use('postcss-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/postcss-loader/src/index.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  ident<span class="token operator">:</span> <span class="token string">'postcss'</span><span class="token punctuation">,</span>
                  <span class="token function-variable function">plugins</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* omitted long function */</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">/* config.module.rule('css').oneOf('css') */</span>
          <span class="token punctuation">{</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token comment">/* config.module.rule('css').oneOf('css').use('extract-css-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/mini-css-extract-plugin/dist/loader.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  publicPath<span class="token operator">:</span> <span class="token string">'./'</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('css').oneOf('css').use('css-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/css-loader/dist/cjs.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  importLoaders<span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('css').oneOf('css').use('postcss-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/postcss-loader/src/index.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  ident<span class="token operator">:</span> <span class="token string">'postcss'</span><span class="token punctuation">,</span>
                  <span class="token function-variable function">plugins</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* omitted long function */</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">/* config.module.rule('less') */</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(less)(\?.*)?$/</span><span class="token punctuation">,</span>
        oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">/* config.module.rule('less').oneOf('css-modules') */</span>
          <span class="token punctuation">{</span>
            resourceQuery<span class="token operator">:</span> <span class="token regex">/modules/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token comment">/* config.module.rule('less').oneOf('css-modules').use('extract-css-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/mini-css-extract-plugin/dist/loader.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  publicPath<span class="token operator">:</span> <span class="token string">'./'</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('less').oneOf('css-modules').use('css-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/css-loader/dist/cjs.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  importLoaders<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  modules<span class="token operator">:</span> <span class="token punctuation">{</span>
                    localIdentName<span class="token operator">:</span> <span class="token string">'[local]___[hash:base64:5]'</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('less').oneOf('css-modules').use('postcss-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/postcss-loader/src/index.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  ident<span class="token operator">:</span> <span class="token string">'postcss'</span><span class="token punctuation">,</span>
                  <span class="token function-variable function">plugins</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* omitted long function */</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('less').oneOf('css-modules').use('less-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/less-loader/dist/cjs.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  modifyVars<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                  javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">/* config.module.rule('less').oneOf('css') */</span>
          <span class="token punctuation">{</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token comment">/* config.module.rule('less').oneOf('css').use('extract-css-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/mini-css-extract-plugin/dist/loader.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  publicPath<span class="token operator">:</span> <span class="token string">'./'</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('less').oneOf('css').use('css-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/css-loader/dist/cjs.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  importLoaders<span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('less').oneOf('css').use('postcss-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/postcss-loader/src/index.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  ident<span class="token operator">:</span> <span class="token string">'postcss'</span><span class="token punctuation">,</span>
                  <span class="token function-variable function">plugins</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* omitted long function */</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token comment">/* config.module.rule('less').oneOf('css').use('less-loader') */</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'/Users/keyang/Workspace/private/umi-learn/node_modules/less-loader/dist/cjs.js'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  modifyVars<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                  javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
</code></pre></div><h1 id="零碎知识"><a href="#零碎知识" class="header-anchor">#</a> 零碎知识</h1> <h2 id="preset-和-plugin-的区别"><a href="#preset-和-plugin-的区别" class="header-anchor">#</a> preset 和 plugin 的区别</h2> <blockquote><p>在babel里，也有plugin和preset的概念；umi里也存在。 这两个概念究竟有什么区别？</p></blockquote> <p>babel是用来编译转化js代码的工具，它的核心转化逻辑都是通过plugin来实现的。</p> <p>plugin一般是一些很小块的功能，拆分的颗粒度比较细，功能单一。</p> <p>而往往项目里，需要用到多个plugin，如果都需要手动一个个去配置，就会很繁琐，也容易出错。</p> <p>举个例子：</p> <p>es6 =&gt; es5 , babel里需要用到的plugin大概有，具体可以参考https://github.com/babel/babel-preset-env/blob/master/data/plugins.json。</p> <div class="language- extra-class"><pre class="language-text"><code> &quot;transform-es2015-arrow-functions&quot;
 &quot;transform-es2015-block-scoped-functions&quot;
 &quot;transform-es2015-block-scoping&quot;
 &quot;transform-es2015-computed-properties&quot;
 &quot;transform-es2015-destructuring&quot;
  &quot;transform-es2015-duplicate-keys
  ....
</code></pre></div><p>那为了让开发引用的更方便，babel就提供了preset的插件集，将一些插件集合起来，单独配置preset就可以了。</p> <p>在umi里，这两个概念也是插件和插件集的意思。不过umi暂时只有一个preset： @umijs/preset-react。</p> <p>它是针对 react 应用的插件集，包含了：</p> <ul><li><a href="https://umijs.org/plugins/plugin-access" target="_blank" rel="noopener noreferrer">plugin-access<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，权限管理</li> <li><a href="https://umijs.org/plugins/plugin-analytics" target="_blank" rel="noopener noreferrer">plugin-analytics<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，统计管理</li> <li><a href="https://umijs.org/plugins/plugin-antd" target="_blank" rel="noopener noreferrer">plugin-antd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，整合 antd UI 组件</li> <li><a href="https://umijs.org/plugins/plugin-crossorigin" target="_blank" rel="noopener noreferrer">plugin-crossorigin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，通常用于 JS 出错统计</li> <li><a href="https://umijs.org/plugins/plugin-dva" target="_blank" rel="noopener noreferrer">plugin-dva<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，整合 dva</li> <li><a href="https://umijs.org/plugins/plugin-helmet" target="_blank" rel="noopener noreferrer">plugin-helmet<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，整合 <a href="https://github.com/nfl/react-helmet" target="_blank" rel="noopener noreferrer">react-helmet<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，管理 HTML 文档标签（如标题、描述等）</li> <li><a href="https://umijs.org/plugins/plugin-initial-state" target="_blank" rel="noopener noreferrer">plugin-initial-state<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，初始化数据管理</li> <li><a href="https://umijs.org/plugins/plugin-layout" target="_blank" rel="noopener noreferrer">plugin-layout<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，配置启用 ant-design-pro 的布局</li> <li><a href="https://umijs.org/plugins/plugin-locale" target="_blank" rel="noopener noreferrer">plugin-locale<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，国际化能力</li> <li><a href="https://umijs.org/plugins/plugin-model" target="_blank" rel="noopener noreferrer">plugin-model<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，基于 hooks 的简易数据流</li> <li><a href="https://umijs.org/plugins/plugin-request" target="_blank" rel="noopener noreferrer">plugin-request<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，基于 umi-request 和 umi-hooks 的请求方案</li></ul> <h2 id="roadhog的配置"><a href="#roadhog的配置" class="header-anchor">#</a> roadhog的配置</h2> <p>https://github.com/sorrycc/blog/issues/55</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.ab75ed54.js" defer></script><script src="/assets/js/2.7c7b516a.js" defer></script><script src="/assets/js/49.37a0c336.js" defer></script>
  </body>
</html>
